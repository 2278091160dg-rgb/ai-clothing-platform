# 飞书表格 AI 对话 URL 配置指南

## 概述

本指南说明如何在飞书多维表格中配置"AI对话"按钮，让用户可以通过点击按钮跳转到 Web 界面进行多轮AI对话优化提示词。

## 配置步骤

### 1. 添加URL字段

在飞书多维表格中添加一个新字段：

```
字段名称：AI对话
字段类型：URL（超链接）
字段说明：点击跳转到AI对话界面进行提示词优化
```

### 2. 配置URL模板

```
URL格式：
https://your-app-domain.com/ai-chat/{record_id}?prompt={提示词}

示例：
https://app.example.com/ai-chat/{record_id}?prompt={提示词}
```

### 3. 配置按钮显示

```
按钮文字：💬 AI对话优化
按钮颜色：蓝色（推荐）
按钮样式：主要按钮
```

## URL参数说明

| 参数          | 说明                       | 示例               |
| ------------- | -------------------------- | ------------------ |
| `{record_id}` | 飞书记录ID（自动填充）     | `rec123456789`     |
| `{提示词}`    | 当前提示词内容（自动填充） | `红色连衣裙，夏装` |

## 完整配置示例

### 方式1：URL字段（推荐）

在飞书多维表格字段配置中：

```javascript
{
  "字段名": "AI对话",
  "字段类型": "URL",
  "字段配置": {
    "URL模板": "https://app.example.com/ai-chat/{record_id}?prompt={提示词}",
    "按钮文字": "💬 AI对话优化",
    "按钮颜色": "blue",
    "打开方式": "新窗口"
  }
}
```

### 方式2：按钮字段（高级）

如果飞书支持自定义按钮字段：

```javascript
{
  "字段名": "AI对话",
  "字段类型": "按钮",
  "字段配置": {
    "按钮文字": "💬 AI对话优化",
    "操作类型": "打开URL",
    "URL": "https://app.example.com/ai-chat/{record_id}?prompt={提示词}",
    "打开方式": "当前窗口"
  }
}
```

### 方式3：脚本按钮（高级）

如果飞书支持脚本按钮：

```javascript
{
  "字段名": "AI对话",
  "字段类型": "按钮",
  "脚本配置": {
    "按钮文字": "💬 AI对话优化",
    "脚本": `
      const recordId = '{record_id}';
      const prompt = '{提示词}';
      const url = \`https://app.example.com/ai-chat/\${recordId}?prompt=\${encodeURIComponent(prompt)}\`;
      window.open(url, '_blank');
    `
  }
}
```

## 完整字段列表建议

为获得最佳用户体验，建议添加以下字段组合：

| 字段名称   | 字段类型      | 用途                            |
| ---------- | ------------- | ------------------------------- |
| 提示词     | 多行文本      | 用户输入提示词                  |
| AI对话     | URL（超链接） | AI对话优化入口                  |
| AI优化版本 | 多行文本      | 存储AI优化后的提示词（可选）    |
| 数据来源   | 单选          | 标识数据来源（用户输入/AI优化） |
| 状态       | 单选          | 任务状态                        |

## URL配置模板

### 开发环境

```
https://localhost:3000/ai-chat/{record_id}?prompt={提示词}
```

### 生产环境

```
https://your-production-domain.com/ai-chat/{record_id}?prompt={提示词}
```

## 用户操作流程

### Web端用户

```
1. 打开任务创建页面
2. 输入提示词
3. 点击"💬 AI对话优化"按钮
4. 侧边栏打开，进行多轮对话
5. 点击"确认并生图"
6. 自动创建任务并生成图片
```

### 飞书表格用户

```
1. 在"提示词"字段输入提示词
2. 点击"💬 AI对话优化"按钮
3. 跳转到Web AI对话页面
4. 进行多轮对话优化
5. 点击"确认并生图"
6. 自动返回飞书表格
```

## 注意事项

1. **URL参数编码**：提示词内容需要使用 `encodeURIComponent()` 进行URL编码
2. **域名配置**：根据实际部署环境修改域名
3. **权限配置**：确保Web页面可被飞书用户访问
4. **返回跳转**：AI对话完成后可以自动跳转回飞书表格

## 测试步骤

1. 在飞书表格中配置URL字段
2. 在"提示词"字段输入测试文本
3. 点击"AI对话"按钮
4. 确认能正常跳转到AI对话页面
5. 进行多轮对话测试
6. 确认优化后的提示词能正常应用

## 故障排除

### 问题：点击按钮无响应

- 检查URL配置是否正确
- 检查域名是否可访问
- 检查网络连接

### 问题：跳转后页面404

- 检查域名配置
- 检查路由配置
- 确认部署完成

### 问题：提示词未传递

- 检查URL参数配置
- 确认字段名称正确
- 检查特殊字符编码

## 相关文档

- [Web UI组件使用指南](./frontend-components-guide.md)
- [API接口文档](./API接口文档.md)
- [部署配置指南](./deployment-guide.md)
