# N8N å·¥ä½œæµå®Œæ•´é…ç½®æŒ‡å—

## ğŸ¯ å®Œæ•´å·¥ä½œæµæ¶æ„

```
å‰ç«¯å‘é€è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹1: Webhook è§¦å‘å™¨                     â”‚
â”‚  - æ¥æ”¶ POST è¯·æ±‚                          â”‚
â”‚  - è·¯å¾„: ai-clothing-generation            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹2: è§£æè¯·æ±‚å‚æ•° (Set)                  â”‚
â”‚  - æå–æ‰€æœ‰JSONå­—æ®µ                        â”‚
â”‚  - taskId, prompt, aiModelç­‰              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚       â”‚       â”‚       â”‚
      â–¼       â–¼       â–¼       â–¼
    1:1     3:4    16:9    9:16
      â”‚       â”‚       â”‚       â”‚
      â–¼       â–¼       â–¼       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚èŠ‚ç‚¹3-1  â”‚ â”‚èŠ‚ç‚¹3-2  â”‚ â”‚èŠ‚ç‚¹3-3  â”‚ â”‚èŠ‚ç‚¹3-4  â”‚
â”‚IFåˆ¤æ–­1:1â”‚ â”‚IFåˆ¤æ–­3:4â”‚ â”‚IFåˆ¤æ–­16:9â”‚ â”‚IFåˆ¤æ–­9:16â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚           â”‚
     â–¼           â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚èŠ‚ç‚¹4-1  â”‚ â”‚èŠ‚ç‚¹4-2  â”‚ â”‚èŠ‚ç‚¹4-3  â”‚ â”‚èŠ‚ç‚¹4-4  â”‚
â”‚Set 1:1  â”‚ â”‚Set 3:4  â”‚ â”‚Set 16:9 â”‚ â”‚Set 9:16 â”‚
â”‚1024x1024â”‚ â”‚768x1024â”‚ â”‚1344x768â”‚ â”‚768x1344â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  èŠ‚ç‚¹5: AIå›¾ç‰‡ç”Ÿæˆ        â”‚
         â”‚  - ä½¿ç”¨å‰ç«¯ä¼ æ¥çš„å‚æ•°    â”‚
         â”‚  - è°ƒç”¨ DeerAPI         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  èŠ‚ç‚¹6: æ ¼å¼åŒ–ç»“æœ        â”‚
         â”‚  - æå–ç”Ÿæˆçš„å›¾ç‰‡æ•°ç»„    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  èŠ‚ç‚¹7: å›è°ƒåç«¯API      â”‚
         â”‚  - é€šçŸ¥åç«¯ä»»åŠ¡å®Œæˆ      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  èŠ‚ç‚¹8: è¿”å›å“åº”          â”‚
         â”‚  - ç»™Webhookè¿”å›æˆåŠŸ    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é€èŠ‚ç‚¹é…ç½®è¯¦è§£

### èŠ‚ç‚¹1: Webhook è§¦å‘å™¨

**èŠ‚ç‚¹ç±»å‹**: `Webhook`
**ä½ç½®**: (240, 300)

**é…ç½®å‚æ•°**:

```
HTTP Method: POST
Path: ai-clothing-generation
Response Mode: responseNode
```

**é‡è¦**: é…ç½®å®Œæˆåï¼Œå¤åˆ¶ **Production URL**ï¼Œæ ¼å¼ç±»ä¼¼ï¼š

```
https://your-n8n-instance.com/webhook/ai-clothing-generation
```

---

### èŠ‚ç‚¹2: è§£æè¯·æ±‚å‚æ•°

**èŠ‚ç‚¹ç±»å‹**: `Set`
**ä½ç½®**: (460, 300)

**é…ç½®å­—æ®µ** (ä½¿ç”¨ Add Assignment æŒ‰é’®):

| å­—æ®µå            | ç±»å‹   | å€¼è¡¨è¾¾å¼                      | è¯´æ˜                |
| ----------------- | ------ | ----------------------------- | ------------------- |
| `taskId`          | String | `{{ $json.taskId }}`          | ä»»åŠ¡ID              |
| `userId`          | String | `{{ $json.userId }}`          | ç”¨æˆ·ID              |
| `productImageUrl` | String | `{{ $json.productImageUrl }}` | å•†å“å›¾ç‰‡URL         |
| `sceneImageUrl`   | String | `{{ $json.sceneImageUrl }}`   | åœºæ™¯å›¾ç‰‡URL         |
| `prompt`          | String | `{{ $json.prompt }}`          | æç¤ºè¯              |
| `aiModel`         | String | `{{ $json.aiModel }}`         | â­ AIæ¨¡å‹ï¼ˆåŠ¨æ€ï¼‰   |
| `aspectRatio`     | String | `{{ $json.aspectRatio }}`     | â­ å›¾ç‰‡æ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰ |
| `imageCount`      | Number | `{{ $json.imageCount }}`      | â­ ç”Ÿæˆæ•°é‡ï¼ˆåŠ¨æ€ï¼‰ |
| `quality`         | String | `{{ $json.quality }}`         | è´¨é‡è®¾ç½®            |
| `callbackUrl`     | String | `{{ $json.callbackUrl }}`     | å›è°ƒåœ°å€            |

**âš ï¸ å…³é”®**: æ‰€æœ‰å¸¦â­çš„å‚æ•°éƒ½æ˜¯ä»å‰ç«¯åŠ¨æ€ä¼ å…¥çš„ï¼Œä¸è¦å†™æ­»ï¼

---

### èŠ‚ç‚¹3-1, 3-2, 3-3, 3-4: IF åˆ¤æ–­èŠ‚ç‚¹

æ¯ä¸ªIFèŠ‚ç‚¹æ£€æŸ¥ä¸€ç§å›¾ç‰‡æ¯”ä¾‹ï¼š

#### IFèŠ‚ç‚¹3-1: åˆ¤æ–­æ˜¯å¦1:1

```
æ¡ä»¶: aspectRatio == "1:1"
```

#### IFèŠ‚ç‚¹3-2: åˆ¤æ–­æ˜¯å¦3:4

```
æ¡ä»¶: aspectRatio == "3:4"
```

#### IFèŠ‚ç‚¹3-3: åˆ¤æ–­æ˜¯å¦16:9

```
æ¡ä»¶: aspectRatio == "16:9"
```

#### IFèŠ‚ç‚¹3-4: åˆ¤æ–­æ˜¯å¦9:16

```
æ¡ä»¶: aspectRatio == "9:16"
```

**æ³¨æ„**: è¿™4ä¸ªIFèŠ‚ç‚¹çš„ **true** è¾“å‡ºåˆ†åˆ«è¿æ¥åˆ°å¯¹åº”çš„å°ºå¯¸è®¾ç½®èŠ‚ç‚¹ã€‚

---

### èŠ‚ç‚¹4-1, 4-2, 4-3, 4-4: å°ºå¯¸è®¾ç½®èŠ‚ç‚¹

#### èŠ‚ç‚¹4-1: 1:1 å°ºå¯¸

```
width = 1024
height = 1024
```

#### èŠ‚ç‚¹4-2: 3:4 å°ºå¯¸

```
width = 768
height = 1024
```

#### èŠ‚ç‚¹4-3: 16:9 å°ºå¯¸

```
width = 1344
height = 768
```

#### èŠ‚ï¿½ç‚¹4-4: 9:16 å°ºå¯¸

```
width = 768
height = 1344
```

---

### èŠ‚ç‚¹5: AIå›¾ç‰‡ç”Ÿæˆ

**èŠ‚ç‚¹ç±»å‹**: `HTTP Request`
**ä½ç½®**: (1140, 320)

**é…ç½®å‚æ•°**:

**åŸºæœ¬è®¾ç½®**:

```
Method: POST
URL: https://api.deerapi.com/v1/ai/generate
```

**è®¤è¯**:

```
Authentication: Generic Credential Type
Credential Type: Header Auth
```

ç‚¹å‡» **"Create New Credential"**:

- Name: `DeerAPIè®¤è¯`
- Header Name: `Authorization`
- Header Value: `Bearer YOUR_DEERAPI_KEY`

**Body å‚æ•°** (é€‰æ‹© JSON):

```json
{
  "model": "{{ $json.aiModel }}",
  "prompt": "{{ $json.prompt }}",
  "image": "{{ $json.productImageUrl }}",
  "width": {{ $json.width }},
  "height": {{ $json.height }},
  "num_images": {{ $json.imageCount }}
}
```

**âš ï¸ å…³é”®ç‚¹**:

- `model`: ä½¿ç”¨ `{{ $json.aiModel }}` - å‰ç«¯é€‰æ‹©ä»€ä¹ˆå°±ç”¨ä»€ä¹ˆ
- `width/height`: æ ¹æ®IFèŠ‚ç‚¹åŠ¨æ€è®¡ç®—
- `num_images`: ä½¿ç”¨å‰ç«¯é€‰æ‹©çš„æ•°é‡

---

### èŠ‚ç‚¹6: æ ¼å¼åŒ–ç»“æœ

**èŠ‚ç‚¹ç±»å‹**: `Set`
**ä½ç½®**: (1360, 320)

**é…ç½®å­—æ®µ**:
| å­—æ®µå | ç±»å‹ | å€¼è¡¨è¾¾å¼ |
|--------|------|----------|
| `resultImageUrls` | Array | `{{ $json.data.images }}` |
| `status` | String | `completed` |

---

### èŠ‚ç‚¹7: å›è°ƒåç«¯API

**èŠ‚ç‚¹ç±»å‹**: `HTTP Request`
**ä½ç½®**: (1580, 320)

**é…ç½®å‚æ•°**:

```
Method: POST
URL: {{ $('è§£æè¯·æ±‚å‚æ•°').item.json.callbackUrl }}
```

**Body** (é€‰æ‹© JSON):

```json
{
  "taskId": "{{ $('è§£æè¯·æ±‚å‚æ•°').item.json.taskId }}",
  "status": "completed",
  "resultImageUrls": "{{ $json.resultImageUrls }}",
  "progress": 100
}
```

**Headers**:

```
x-n8n-api-key: your-api-key-from-env
```

---

### èŠ‚ç‚¹8: è¿”å›æˆåŠŸå“åº”

**èŠ‚ç‚¹ç±»å‹**: `Respond to Webhook`
**ä½ç½®**: (1800, 320)

**é…ç½®**:

```
Respond With: JSON
Response Code: 200
```

**Response Body** (é€‰æ‹© JSON):

```json
{
  "success": true,
  "taskId": "{{ $('è§£æè¯·æ±‚å‚æ•°').item.json.taskId }}",
  "message": "å›¾ç‰‡ç”ŸæˆæˆåŠŸ"
}
```

---

## ğŸ”— èŠ‚ç‚¹è¿æ¥å…³ç³»

```
è§£æè¯·æ±‚å‚æ•° â†’ åˆ†æˆ4è·¯ â†’ 4ä¸ªIFèŠ‚ç‚¹
                              â†“
                              4ä¸ªå°ºå¯¸èŠ‚ç‚¹ â†’ éƒ½è¿åˆ°AIç”ŸæˆèŠ‚ç‚¹
                                           â†“
                                      æ ¼å¼åŒ–ç»“æœ
                                           â†“
                                      å›è°ƒåç«¯API
                                           â†“
                                      è¿”å›å“åº”
```

**è¿æ¥æ–¹å¼**:

1. æ‹–åŠ¨èŠ‚ç‚¹ä¸Šçš„åœ†ç‚¹åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
2. ç¡®ä¿æ‰€æœ‰4ä¸ªå°ºå¯¸èŠ‚ç‚¹çš„è¾“å‡ºéƒ½è¿åˆ° **"AIå›¾ç‰‡ç”Ÿæˆ"** èŠ‚ç‚¹

---

## ğŸ¨ å‰ç«¯å‚æ•°å¦‚ä½•ä¼ é€’

### ç¤ºä¾‹1: ç”¨æˆ·é€‰æ‹© 1:1 æ¯”ä¾‹

**å‰ç«¯å‘é€**:

```json
{
  "aspectRatio": "1:1",
  "aiModel": "flux-realism",
  "imageCount": 4
}
```

**N8Nå¤„ç†æµç¨‹**:

```
è§£æå‚æ•° â†’ aspectRatio = "1:1"
            â†“
         IFèŠ‚ç‚¹3-1 â†’ true â†’ è¿›å…¥"1:1å°ºå¯¸"
                           â†“
                      width=1024, height=1024
                           â†“
                      AIç”Ÿæˆä½¿ç”¨è¿™äº›å°ºå¯¸
```

### ç¤ºä¾‹2: ç”¨æˆ·é€‰æ‹© 16:9 æ¯”ä¾‹

**å‰ç«¯å‘é€**:

```json
{
  "aspectRatio": "16:9",
  "aiModel": "flux-1.1-pro",
  "imageCount": 8
}
```

**N8Nå¤„ç†æµç¨‹**:

```
è§£æå‚æ•° â†’ aspectRatio = "16:9"
            â†“
         IFèŠ‚ç‚¹3-3 â†’ true â†’ è¿›å…¥"16:9å°ºå¯¸"
                           â†“
                      width=1344, height=768
                           â†“
                      AIç”Ÿæˆä½¿ç”¨è¿™äº›å°ºå¯¸
```

---

## âš ï¸ å¸¸è§é…ç½®é”™è¯¯

### é”™è¯¯1: IFèŠ‚ç‚¹æ²¡æœ‰è¿æ¥

**é—®é¢˜**: 4ä¸ªIFèŠ‚ç‚¹çš„ true è¾“å‡ºæ²¡æœ‰è¿æ¥åˆ°å¯¹åº”çš„å°ºå¯¸èŠ‚ç‚¹

**è§£å†³**: æ‹–åŠ¨æ¯ä¸ªIFèŠ‚ç‚¹çš„ç»¿è‰²åœ†ç‚¹ï¼ˆtrueè¾“å‡ºï¼‰åˆ°å¯¹åº”çš„å°ºå¯¸èŠ‚ç‚¹

### é”™è¯¯2: å°ºå¯¸èŠ‚ç‚¹çš„è¾“å‡ºæ²¡æœ‰åˆå¹¶

**é—®é¢˜**: 4ä¸ªå°ºå¯¸èŠ‚ç‚¹çš„è¾“å‡ºæ²¡æœ‰éƒ½è¿åˆ°AIç”ŸæˆèŠ‚ç‚¹

**è§£å†³**: æ‹–åŠ¨4ä¸ªå°ºå¯¸èŠ‚ç‚¹çš„ç»¿è‰²åœ†ç‚¹éƒ½è¿åˆ° **"AIå›¾ç‰‡ç”Ÿæˆ"** èŠ‚ç‚¹

### é”™è¯¯3: å‚æ•°å¼•ç”¨é”™è¯¯

**é—®é¢˜**: åœ¨HTTP Requestçš„Bodyä¸­ç›´æ¥å†™ `{{ aiModel }}`

**è§£å†³**: åº”è¯¥å†™ `{{ $json.aiModel }}`

### é”™è¯¯4: è®¤è¯é…ç½®é”™è¯¯

**é—®é¢˜**: æ²¡æœ‰é…ç½®DeerAPIè®¤è¯æˆ–è®¤è¯æ ¼å¼é”™è¯¯

**è§£å†³**:

1. åˆ›å»º Header Auth ç±»å‹çš„è®¤è¯
2. Name: `Authorization`
3. Value: `Bearer YOUR_KEY`

---

## âœ… å¯¼å…¥æ­¥éª¤

### æ–¹æ³•1: å¯¼å…¥JSONæ–‡ä»¶

1. æ‰“å¼€N8N
2. ç‚¹å‡»å³ä¸Šè§’ `+` æŒ‰é’®
3. é€‰æ‹© **"Import from File"**
4. é€‰æ‹© `docs/n8n-workflow-full.json`
5. ç‚¹å‡» **"Import"**

### æ–¹æ³•2: æ‰‹åŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰

æŒ‰ç…§ä¸Šé¢çš„èŠ‚ç‚¹è¯´æ˜é€ä¸ªåˆ›å»ºï¼Œè¿™æ ·æ›´å®¹æ˜“ç†è§£æ¯ä¸ªèŠ‚ç‚¹çš„ä½œç”¨ã€‚

---

## ğŸ§ª æµ‹è¯•å·¥ä½œæµ

### å‡†å¤‡æµ‹è¯•æ•°æ®

```json
{
  "taskId": "test-task-001",
  "userId": "dev-user-123",
  "productImageUrl": "https://picsum.photos/1024/1024",
  "prompt": "æ—¶å°šæ¨¡ç‰¹åœ¨è¡—å¤´",
  "aiModel": "flux-realism",
  "aspectRatio": "16:9",
  "imageCount": 4,
  "quality": "high",
  "callbackUrl": "http://localhost:3000/api/webhooks/n8n/callback"
}
```

### æµ‹è¯•æ­¥éª¤

1. ç‚¹å‡» **"Webhookè§¦å‘å™¨"** èŠ‚ç‚¹
2. ç‚¹å‡» **"Listen for Test Event"**
3. ä½¿ç”¨ curl å‘é€æµ‹è¯•è¯·æ±‚
4. è§‚å¯Ÿæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œç»“æœ

---

## ğŸ“Š å®Œæ•´çš„æ•°æ®æµç¤ºä¾‹

### å‰ç«¯é€‰æ‹©: flux-realism, 16:9, 4å¼ å›¾

```
å‰ç«¯ â†’ åç«¯ â†’ N8N Webhook
                    â†“
            è§£æå‚æ•°:
              - aiModel = "flux-realism"
              - aspectRatio = "16:9"
              - imageCount = 4
                    â†“
            IFåˆ¤æ–­: aspectRatio == "16:9" â†’ true
                    â†“
            è®¾ç½®å°ºå¯¸: width=1344, height=768
                    â†“
            AIç”Ÿæˆ:
              - model = "flux-realism"
              - width = 1344
              - height = 768
              - num_images = 4
                    â†“
            æ ¼å¼åŒ–ç»“æœ â†’ å›è°ƒåç«¯ â†’ è¿”å›å“åº”
```

---

**è¿™æ ·é…ç½®åï¼Œå‰ç«¯çš„æ‰€æœ‰å‚æ•°éƒ½ä¼šæ­£ç¡®ä¼ é€’åˆ°N8Nå’ŒAIæœåŠ¡ï¼** ğŸ‰
