# N8N åŒæºå·¥ä½œæµå®Œæ•´é…ç½®æŒ‡å—

## ğŸ¯ å·¥ä½œæµæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**ç»Ÿä¸€å·¥ä½œæµ**ï¼Œæ”¯æŒä¸¤ç§æ•°æ®æ¥æºï¼š

1. **å‰ç«¯è§¦å‘** - ç”¨æˆ·åœ¨å‰ç«¯UIæ“ä½œ
2. **é£ä¹¦å¤šç»´è¡¨æ ¼è§¦å‘** - ç”¨æˆ·åœ¨é£ä¹¦è¡¨æ ¼ä¸­ç›´æ¥æ“ä½œ

### æ ¸å¿ƒç‰¹æ€§

âœ… **åŒæºæ”¯æŒ**: ä¸€ä¸ªå·¥ä½œæµå¤„ç†ä¸¤ç§æ¥æº
âœ… **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨è¯†åˆ«æ•°æ®æºå¹¶åˆ†æµå¤„ç†
âœ… **äºŒè¿›åˆ¶æ•°æ®å¤„ç†**: ä¿ç•™é£ä¹¦ä¸Šä¼ å¿…éœ€çš„å…³é”®èŠ‚ç‚¹
âœ… **å…¨æ¯”ä¾‹æ”¯æŒ**: 1:1ã€3:4ã€16:9ã€9:16
âœ… **åŠ¨æ€å‚æ•°**: æ‰€æœ‰å‚æ•°ä»å‰ç«¯/é£ä¹¦åŠ¨æ€ä¼ å…¥

---

## ğŸ“Š å®Œæ•´æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç»Ÿä¸€Webhookå…¥å£    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    è¯†åˆ«æ•°æ®æº        â”‚
                    â”‚ sourceåˆ¤æ–­          â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚å‰ç«¯è·¯å¾„     â”‚  â”‚é£ä¹¦è·¯å¾„     â”‚
                  â”‚(frontend)  â”‚  â”‚(feishu)    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚
              â”‚ è§£æå‰ç«¯å‚æ•°    â”‚     â”‚
              â”‚ æ‰å¹³JSONç»“æ„   â”‚     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
                         â”‚           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚
              â”‚ 4ä¸ªæ¯”ä¾‹IFèŠ‚ç‚¹   â”‚     â”‚
              â”‚ 1:1/3:4/16:9/9:16â”‚   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
                         â”‚           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚
              â”‚ 4ä¸ªå°ºå¯¸è®¾ç½®èŠ‚ç‚¹ â”‚     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
                         â”‚           â”‚
                         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                         â”‚    â”‚ ä¸‹è½½é£ä¹¦å›¾ç‰‡ â”‚
                         â”‚    â”‚ ä»file_token â”‚
                         â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    â”‚ âš ï¸äºŒè¿›åˆ¶æ•°æ®å¤„ç†    â”‚
                         â”‚    â”‚ (é£ä¹¦ä¸Šä¼ å¿…éœ€èŠ‚ç‚¹)   â”‚
                         â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                         â”‚    â”‚è®¾ç½®å›¾ç‰‡URL  â”‚
                         â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AIå›¾ç‰‡ç”Ÿæˆ (åˆå¹¶)   â”‚
                    â”‚   DeerAPIè°ƒç”¨        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ ¼å¼åŒ–ç»“æœ         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  åˆ¤æ–­ç»“æœè¿”å›è·¯å¾„    â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚å‰ç«¯è·¯å¾„     â”‚  â”‚é£ä¹¦è·¯å¾„     â”‚
                  â”‚å›è°ƒåç«¯API  â”‚  â”‚æ›´æ–°é£ä¹¦è®°å½• â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è¿”å›æˆåŠŸå“åº”       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ èŠ‚ç‚¹é…ç½®è¯¦è§£

### èŠ‚ç‚¹1: ç»Ÿä¸€Webhookå…¥å£

**ç±»å‹**: `Webhook`
**ä½ç½®**: (240, 300)

**é…ç½®**:

```
HTTP Method: POST
Path: ai-clothing-generation
Response Mode: responseNode
```

**æ¥æ”¶ä¸¤ç§æ•°æ®æ ¼å¼**:

#### æ ¼å¼1: å‰ç«¯è¯·æ±‚

```json
{
  "taskId": "uuid-123",
  "userId": "user-456",
  "productImageUrl": "http://backend/uploads/abc.jpg",
  "sceneImageUrl": "http://backend/uploads/scene.jpg",
  "prompt": "æ—¶å°šæ¨¡ç‰¹åœ¨è¡—å¤´",
  "aiModel": "flux-realism",
  "aspectRatio": "16:9",
  "imageCount": 4,
  "quality": "high",
  "callbackUrl": "http://backend/api/webhooks/n8n/callback"
}
```

#### æ ¼å¼2: é£ä¹¦è¯·æ±‚

```json
{
  "record_id": "rec12345",
  "fields": {
    "å•†å“å›¾ç‰‡": ["img_token_abc"],
    "æç¤ºè¯": "æ—¶å°šæ¨¡ç‰¹åœ¨è¡—å¤´",
    "AIæ¨¡å‹": "flux-realism",
    "å›¾ç‰‡æ¯”ä¾‹": "16:9",
    "ç”Ÿæˆæ•°é‡": 4
  },
  "source": "feishu"
}
```

---

### èŠ‚ç‚¹2: è¯†åˆ«æ•°æ®æº

**ç±»å‹**: `Set`
**ä½ç½®**: (460, 300)

**ä½œç”¨**: åˆ¤æ–­è¯·æ±‚æ¥æº

**é…ç½®å­—æ®µ**:
| å­—æ®µå | å€¼è¡¨è¾¾å¼ | è¯´æ˜ |
|--------|----------|------|
| `dataSource` | `{{ $json.source ? 'feishu' : 'frontend' }}` | å¦‚æœæœ‰sourceå­—æ®µåˆ™ä¸ºé£ä¹¦ |
| `taskId` | `{{ $json.taskId \|\| $json.record_id }}` | ç»Ÿä¸€IDå­—æ®µ |
| `rawData` | `{{ $json }}` | ä¿ç•™åŸå§‹æ•°æ® |

---

### èŠ‚ç‚¹3: åˆ¤æ–­æ˜¯å¦é£ä¹¦æ¥æº

**ç±»å‹**: `IF`
**ä½ç½®**: (680, 300)

**æ¡ä»¶**:

```javascript
dataSource == 'feishu';
```

**è·¯ç”±**:

- `true` â†’ é£ä¹¦è·¯å¾„
- `false` â†’ å‰ç«¯è·¯å¾„

---

### èŠ‚ç‚¹4A: è§£æå‰ç«¯å‚æ•°

**ç±»å‹**: `Set`
**ä½ç½®**: (900, 200)

**é…ç½®å­—æ®µ**:
| å­—æ®µå | å€¼è¡¨è¾¾å¼ | è¯´æ˜ |
|--------|----------|------|
| `taskId` | `{{ $json.rawData.taskId }}` | ä»»åŠ¡ID |
| `userId` | `{{ $json.rawData.userId }}` | ç”¨æˆ·ID |
| `productImageUrl` | `{{ $json.rawData.productImageUrl }}` | å•†å“å›¾ç‰‡URL |
| `prompt` | `{{ $json.rawData.prompt }}` | æç¤ºè¯ |
| `aiModel` | `{{ $json.rawData.aiModel }}` | AIæ¨¡å‹ |
| `aspectRatio` | `{{ $json.rawData.aspectRatio }}` | å›¾ç‰‡æ¯”ä¾‹ |
| `imageCount` | `{{ $json.rawData.imageCount }}` | ç”Ÿæˆæ•°é‡ |
| `callbackUrl` | `{{ $json.rawData.callbackUrl }}` | å›è°ƒåœ°å€ |

---

### èŠ‚ç‚¹4B: è§£æé£ä¹¦å‚æ•°

**ç±»å‹**: `Set`
**ä½ç½®**: (900, 400)

**é…ç½®å­—æ®µ**:
| å­—æ®µå | å€¼è¡¨è¾¾å¼ | è¯´æ˜ |
|--------|----------|------|
| `recordId` | `{{ $json.rawData.record_id }}` | é£ä¹¦è®°å½•ID |
| `prompt` | `{{ $json.rawData.fields['æç¤ºè¯'] }}` | ä»åµŒå¥—fieldsæå– |
| `aiModel` | `{{ $json.rawData.fields['AIæ¨¡å‹'] }}` | ä»åµŒå¥—fieldsæå– |
| `aspectRatio` | `{{ $json.rawData.fields['å›¾ç‰‡æ¯”ä¾‹'] }}` | ä»åµŒå¥—fieldsæå– |
| `imageCount` | `{{ $json.rawData.fields['ç”Ÿæˆæ•°é‡'] }}` | ä»åµŒå¥—fieldsæå– |
| `productImageToken` | `{{ $json.rawData.fields['å•†å“å›¾ç‰‡'][0] }}` | å›¾ç‰‡token |

---

### èŠ‚ç‚¹5: ä¸‹è½½é£ä¹¦å›¾ç‰‡

**ç±»å‹**: `HTTP Request`
**ä½ç½®**: (1140, 400)

**é…ç½®**:

```
Method: GET
URL: https://open.feishu.cn/open-apis/drive/v1/medias/{{ productImageToken }}/download
Response Format: File
```

**è®¤è¯**: ä½¿ç”¨é£ä¹¦APIè®¤è¯

**ä½œç”¨**: å°†é£ä¹¦çš„file_tokenè½¬æ¢ä¸ºå¯ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶

---

### âš ï¸ èŠ‚ç‚¹6: äºŒè¿›åˆ¶æ•°æ®å¤„ç†ï¼ˆé£ä¹¦ä¸Šä¼ å¿…éœ€ï¼‰

**ç±»å‹**: `Code`
**ä½ç½®**: (1360, 400)

**è¿™æ˜¯æœ€å…³é”®çš„èŠ‚ç‚¹ï¼å¿…é¡»ä¿ç•™ï¼**

**JavaScriptä»£ç **:

```javascript
// è·å–æ‰€æœ‰è¾“å…¥æ•°æ®
const items = $input.all();

// å¾ªç¯å¤„ç†æ¯ä¸€æ¡æ•°æ®
for (let i = 0; i < items.length; i++) {
  const item = items[i];

  if (item.binary && item.binary.data) {
    // âš ï¸ã€å…³é”®ã€‘ä½¿ç”¨ helper æ–¹æ³•å¼ºåˆ¶ä»ç¡¬ç›˜è¯»å–æ–‡ä»¶çš„äºŒè¿›åˆ¶æµ
    // è¿™æ ·æ— è®ºå®ƒæ˜¯å†…å­˜è¿˜æ˜¯ç¡¬ç›˜æ¨¡å¼ï¼Œéƒ½èƒ½è¯»åˆ°çœŸæ­£çš„æ–‡ä»¶
    const buffer = await this.helpers.getBinaryDataBuffer(i, 'data');

    // ç°åœ¨ç®—å‡ºæ¥çš„ length æ‰æ˜¯çœŸå®çš„å­—èŠ‚æ•°ï¼ˆæ¯”å¦‚ 1354024ï¼‰
    item.json.real_size = buffer.length;

    // è®¾ç½®å¥½æ–‡ä»¶å
    item.json.file_name = 'final_product.png';
  }
}

return items;
```

**ä¸ºä»€ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å¿…ä¸å¯å°‘ï¼Ÿ**

1. **å¼ºåˆ¶ä»ç£ç›˜è¯»å–**: ä½¿ç”¨ `helpers.getBinaryDataBuffer()` ç¡®ä¿è¯»å–çœŸå®æ–‡ä»¶
2. **è®¡ç®—çœŸå®å¤§å°**: è·å–å‡†ç¡®çš„å­—èŠ‚æ•°ï¼Œä¸æ˜¯é¢„ä¼°å¤§å°
3. **è®¾ç½®æ–‡ä»¶å**: ä¸ºä¸Šä¼ åˆ°é£ä¹¦å‡†å¤‡æ­£ç¡®çš„æ–‡ä»¶å
4. **é¿å…å†…å­˜é—®é¢˜**: å¤„ç†å¤§æ–‡ä»¶æ—¶é¿å…å†…å­˜æº¢å‡º

âš ï¸ **å¦‚æœåˆ é™¤è¿™ä¸ªèŠ‚ç‚¹ï¼Œé£ä¹¦ä¸Šä¼ ä¼šå¤±è´¥ï¼**

---

### èŠ‚ç‚¹7: è®¾ç½®é£ä¹¦å›¾ç‰‡URL

**ç±»å‹**: `Set`
**ä½ç½®**: (1580, 400)

**é…ç½®å­—æ®µ**:
| å­—æ®µå | å€¼è¡¨è¾¾å¼ | è¯´æ˜ |
|--------|----------|------|
| `productImageUrl` | `{{ $binary.data.url }}` | ä»äºŒè¿›åˆ¶æ•°æ®æå–URL |

**ä½œç”¨**: å°†å¤„ç†åçš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºAIæœåŠ¡å¯ç”¨çš„URL

---

### èŠ‚ç‚¹8-11: æ¯”ä¾‹åˆ¤æ–­IFèŠ‚ç‚¹

**4ä¸ªå¹¶è¡ŒIFèŠ‚ç‚¹**: åˆ¤æ–­1:1ã€3:4ã€16:9ã€9:16

æ¯ä¸ªèŠ‚ç‚¹é…ç½®ç¤ºä¾‹:

```
æ¡ä»¶: aspectRatio == "1:1"
```

---

### èŠ‚ç‚¹12-15: å°ºå¯¸è®¾ç½®èŠ‚ç‚¹

**4ä¸ªå°ºå¯¸èŠ‚ç‚¹**:

- 1:1 â†’ 1024x1024
- 3:4 â†’ 768x1024
- 16:9 â†’ 1344x768
- 9:16 â†’ 768x1344

---

### èŠ‚ç‚¹16: AIå›¾ç‰‡ç”Ÿæˆ

**ç±»å‹**: `HTTP Request`
**ä½ç½®**: (2260, 320)

**é…ç½®**:

```
Method: POST
URL: https://api.deerapi.com/v1/ai/generate
Authentication: DeerAPIè®¤è¯
```

**Body (JSON)**:

```json
{
  "model": "{{ $json.aiModel }}",
  "prompt": "{{ $json.prompt }}",
  "image": "{{ $json.productImageUrl }}",
  "width": {{ $json.width }},
  "height": {{ $json.height }},
  "num_images": {{ $json.imageCount }}
}
```

---

### èŠ‚ç‚¹17: æ ¼å¼åŒ–ç»“æœ

**ç±»å‹**: `Set`
**ä½ç½®**: (2480, 320)

**é…ç½®**:
| å­—æ®µå | å€¼è¡¨è¾¾å¼ |
|--------|----------|
| `resultImageUrls` | `{{ $json.data.images }}` |
| `status` | `completed` |

---

### èŠ‚ç‚¹18: åˆ¤æ–­ç»“æœè¿”å›è·¯å¾„

**ç±»å‹**: `IF`
**ä½ç½®**: (2700, 320)

**æ¡ä»¶**:

```javascript
dataSource == 'feishu';
```

**è·¯ç”±**:

- `true` â†’ æ›´æ–°é£ä¹¦è®°å½•
- `false` â†’ å›è°ƒåç«¯API

---

### èŠ‚ç‚¹19A: å›è°ƒåç«¯API

**ç±»å‹**: `HTTP Request`
**ä½ç½®**: (2920, 200)

**é…ç½®**:

```
Method: POST
URL: {{ $('è§£æå‰ç«¯å‚æ•°').item.json.callbackUrl }}
```

**Body**:

```json
{
  "taskId": "{{ $('è§£æå‰ç«¯å‚æ•°').item.json.taskId }}",
  "status": "completed",
  "resultImageUrls": "{{ $json.resultImageUrls }}",
  "progress": 100
}
```

---

### èŠ‚ç‚¹19B: æ ¼å¼åŒ–é£ä¹¦ç»“æœ

**ç±»å‹**: `Set`
**ä½ç½®**: (2920, 400)

**é…ç½®**:
| å­—æ®µå | å€¼è¡¨è¾¾å¼ | è¯´æ˜ |
|--------|----------|------|
| `ç”Ÿæˆç»“æœ` | `{{ $json.resultImageUrls }}` | é£ä¹¦å­—æ®µå |
| `çŠ¶æ€` | `å·²å®Œæˆ` | é£ä¹¦å­—æ®µå |

---

### èŠ‚ç‚¹20: æ›´æ–°é£ä¹¦è®°å½•

**ç±»å‹**: `HTTP Request`
**ä½ç½®**: (3140, 400)

**é…ç½®**:

```
Method: PUT
URL: https://open.feishu.cn/open-apis/bitable/v1/apps/${FEISHU_BITABLE_APP_TOKEN}/tables/${FEISHU_BITABLE_TABLE_ID}/records/{{ $('è§£æé£ä¹¦å‚æ•°').item.json.recordId }}
```

**Body**:

```json
{
  "fields": {{ $('æ ¼å¼åŒ–é£ä¹¦ç»“æœ').item.json }}
}
```

---

### èŠ‚ç‚¹21: è¿”å›æˆåŠŸå“åº”

**ç±»å‹**: `Respond to Webhook`
**ä½ç½®**: (3360, 320)

**é…ç½®**:

```
Response Code: 200
Response Body: JSON
```

```json
{
  "success": true,
  "taskId": "{{ $('è§£æå‰ç«¯å‚æ•°').item.json.taskId || $('è§£æé£ä¹¦å‚æ•°').item.json.recordId }}",
  "message": "å›¾ç‰‡ç”ŸæˆæˆåŠŸ"
}
```

---

## ğŸ”§ å¿…éœ€çš„è®¤è¯é…ç½®

### 1. DeerAPIè®¤è¯

**ç±»å‹**: `Header Auth`
**é…ç½®**:

```
Header Name: Authorization
Header Value: Bearer YOUR_DEERAPI_KEY
```

### 2. é£ä¹¦APIè®¤è¯

**ç±»å‹**: `Header Auth`
**é…ç½®**:

```
Header Name: Authorization
Header Value: Bearer {{ $env.FEISHU_APP_ACCESS_TOKEN }}
```

### 3. ç¯å¢ƒå˜é‡

éœ€è¦åœ¨N8Nä¸­è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡:

```bash
# é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®
FEISHU_BITABLE_APP_TOKEN=app_xxxxxxxxx
FEISHU_BITABLE_TABLE_ID=tblxxxxxxxxxx
FEISHU_APP_ACCESS_TOKEN=your_app_access_token
```

---

## ğŸ“¥ å¯¼å…¥æ­¥éª¤

### 1. å¯¼å…¥å·¥ä½œæµ

```bash
# åœ¨N8Nç•Œé¢ä¸­:
1. ç‚¹å‡»å³ä¸Šè§’ "+" æŒ‰é’®
2. é€‰æ‹© "Import from File"
3. é€‰æ‹© docs/n8n-workflow-dual-source.json
4. ç‚¹å‡» "Import"
```

### 2. é…ç½®è®¤è¯

```bash
# DeerAPI
1. æ‰“å¼€ "AIå›¾ç‰‡ç”Ÿæˆ" èŠ‚ç‚¹
2. åœ¨ Credentials ä¸­åˆ›å»º "DeerAPIè®¤è¯"
3. è¾“å…¥ä½ çš„API Key

# é£ä¹¦API
1. æ‰“å¼€ "ä¸‹è½½é£ä¹¦å›¾ç‰‡" èŠ‚ç‚¹
2. åœ¨ Credentials ä¸­åˆ›å»º "é£ä¹¦APIè®¤è¯"
3. è¾“å…¥ä½ çš„é£ä¹¦App Access Token
```

### 3. è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# åœ¨N8Nçš„ .env æ–‡ä»¶ä¸­æ·»åŠ :
FEISHU_BITABLE_APP_TOKEN=app_xxxxxxxxx
FEISHU_BITABLE_TABLE_ID=tblxxxxxxxxxx
FEISHU_APP_ACCESS_TOKEN=your_app_access_token

# é‡å¯N8NæœåŠ¡
```

---

## ğŸ§ª æµ‹è¯•å·¥ä½œæµ

### æµ‹è¯•1: å‰ç«¯è·¯å¾„

**è¯·æ±‚æ•°æ®**:

```json
{
  "taskId": "test-frontend-001",
  "userId": "user-123",
  "productImageUrl": "https://picsum.photos/1024/1024",
  "prompt": "æ—¶å°šæ¨¡ç‰¹åœ¨è¡—å¤´",
  "aiModel": "flux-realism",
  "aspectRatio": "16:9",
  "imageCount": 4,
  "quality": "high",
  "callbackUrl": "http://localhost:3000/api/webhooks/n8n/callback"
}
```

**é¢„æœŸæµç¨‹**:

```
Webhook â†’ è¯†åˆ«ä¸ºfrontend â†’ è§£æå‰ç«¯å‚æ•° â†’ 16:9åˆ†æ”¯ â†’ AIç”Ÿæˆ â†’ å›è°ƒåç«¯ â†’ è¿”å›æˆåŠŸ
```

### æµ‹è¯•2: é£ä¹¦è·¯å¾„

**è¯·æ±‚æ•°æ®**:

```json
{
  "record_id": "rec12345",
  "fields": {
    "å•†å“å›¾ç‰‡": ["img_token_abc"],
    "æç¤ºè¯": "æ—¶å°šæ¨¡ç‰¹åœ¨è¡—å¤´",
    "AIæ¨¡å‹": "flux-realism",
    "å›¾ç‰‡æ¯”ä¾‹": "16:9",
    "ç”Ÿæˆæ•°é‡": 4
  },
  "source": "feishu"
}
```

**é¢„æœŸæµç¨‹**:

```
Webhook â†’ è¯†åˆ«ä¸ºfeishu â†’ è§£æé£ä¹¦å‚æ•° â†’ ä¸‹è½½å›¾ç‰‡ â†’ âš ï¸äºŒè¿›åˆ¶å¤„ç† â†’ è®¾ç½®URL â†’ 16:9åˆ†æ”¯ â†’ AIç”Ÿæˆ â†’ æ ¼å¼åŒ–é£ä¹¦ç»“æœ â†’ æ›´æ–°é£ä¹¦è®°å½• â†’ è¿”å›æˆåŠŸ
```

---

## âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹

### 1. äºŒè¿›åˆ¶æ•°æ®å¤„ç†èŠ‚ç‚¹

âœ… **å¿…é¡»ä¿ç•™**: è¿™æ˜¯é£ä¹¦ä¸Šä¼ æˆåŠŸçš„å…³é”®
âŒ **ä¸èƒ½åˆ é™¤**: åˆ é™¤åé£ä¹¦ä¸Šä¼ ä¼šå¤±è´¥
ğŸ”§ **ä¸èƒ½ä¿®æ”¹**: ä»£ç é€»è¾‘ç»è¿‡éªŒè¯

**è¯¥èŠ‚ç‚¹çš„ä½œç”¨**:

- å¼ºåˆ¶ä»ç£ç›˜è¯»å–æ–‡ä»¶ï¼ˆé¿å…å†…å­˜é—®é¢˜ï¼‰
- è®¡ç®—çœŸå®æ–‡ä»¶å¤§å°ï¼ˆä¸æ˜¯é¢„ä¼°å€¼ï¼‰
- è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶å
- ç¡®ä¿äºŒè¿›åˆ¶æ•°æ®å®Œæ•´æ€§

### 2. æ•°æ®æºè¯†åˆ«

ç¡®ä¿æ‰€æœ‰å‰ç«¯è¯·æ±‚**ä¸å¸¦** `source` å­—æ®µ
ç¡®ä¿æ‰€æœ‰é£ä¹¦è¯·æ±‚**å¿…é¡»å¸¦** `source: "feishu"` å­—æ®µ

### 3. ç¯å¢ƒå˜é‡

æ‰€æœ‰é£ä¹¦ç›¸å…³çš„tokenéƒ½åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®ï¼Œä¸è¦ç¡¬ç¼–ç åœ¨èŠ‚ç‚¹é‡Œ

### 4. å›è°ƒURL

å‰ç«¯è·¯å¾„çš„callbackUrlæ˜¯å¿…éœ€çš„ï¼Œé£ä¹¦è·¯å¾„ä¸éœ€è¦

---

## ğŸ¯ æ€»ç»“

è¿™ä¸ªç»Ÿä¸€å·¥ä½œæµçš„ä¼˜ç‚¹:

âœ… **ä¸€ä¸ªå·¥ä½œæµå¤„ç†ä¸¤ç§æ¥æº** - æ˜“äºç»´æŠ¤
âœ… **æ™ºèƒ½è·¯ç”±** - è‡ªåŠ¨è¯†åˆ«æ•°æ®æº
âœ… **ä¿ç•™å…³é”®èŠ‚ç‚¹** - äºŒè¿›åˆ¶æ•°æ®å¤„ç†ä¸å¯æˆ–ç¼º
âœ… **å®Œæ•´å‚æ•°æ”¯æŒ** - æ‰€æœ‰å‚æ•°åŠ¨æ€ä¼ å…¥
âœ… **å…¨æ¯”ä¾‹æ”¯æŒ** - 1:1ã€3:4ã€16:9ã€9:16

ç°åœ¨ä½ å¯ä»¥:

1. åœ¨å‰ç«¯æ“ä½œ â†’ è§¦å‘N8N â†’ ç»“æœå›è°ƒåç«¯
2. åœ¨é£ä¹¦è¡¨æ ¼æ“ä½œ â†’ è§¦å‘N8N â†’ ç»“æœå†™å›é£ä¹¦è¡¨æ ¼

**ä¸¤ç§è·¯å¾„éƒ½å®Œå…¨æ”¯æŒï¼** ğŸ‰
