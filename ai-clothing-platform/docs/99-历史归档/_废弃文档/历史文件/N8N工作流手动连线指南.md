# 🔗 N8N工作流手动连线指南

## 📋 前言

如果导入JSON后节点散落且没有连线，请按照本指南手动连接。

---

## ✅ 工作流1：前端触发（14个节点）

### 节点列表

| 节点ID                | 节点名称      | 位置说明      |
| --------------------- | ------------- | ------------- |
| node-webhook-trigger  | Webhook触发器 | 起点          |
| node-parse-params     | 解析请求参数  | 第1个处理节点 |
| node-check-1to1       | 判断是否1:1   | 比例判断1     |
| node-check-3to4       | 判断是否3:4   | 比例判断2     |
| node-check-16to9      | 判断是否16:9  | 比例判断3     |
| node-check-9to16      | 判断是否9:16  | 比例判断4     |
| node-size-1to1        | 1:1尺寸       | 尺寸设置1     |
| node-size-3to4        | 3:4尺寸       | 尺寸设置2     |
| node-size-16to9       | 16:9尺寸      | 尺寸设置3     |
| node-size-9to16       | 9:16尺寸      | 尺寸设置4     |
| node-ai-generate      | AI图片生成    | 核心节点      |
| node-format-result    | 格式化结果    | 结果处理      |
| node-callback         | 回调后端API   | 回调节点      |
| node-webhook-response | 返回成功响应  | 终点          |

### 连线顺序

```
1. Webhook触发器 → 解析请求参数

2. 解析请求参数 → 判断是否1:1
   解析请求参数 → 判断是否3:4
   解析请求参数 → 判断是否16:9
   解析请求参数 → 判断是否9:16
   ⬆️ 一对四连接（并行）

3. 判断是否1:1 → 1:1尺寸（仅YES分支）
   判断是否3:4 → 3:4尺寸（仅YES分支）
   判断是否16:9 → 16:9尺寸（仅YES分支）
   判断是否9:16 → 9:16尺寸（仅YES分支）

4. 1:1尺寸 → AI图片生成
   3:4尺寸 → AI图片生成
   16:9尺寸 → AI图片生成
   9:16尺寸 → AI图片生成
   ⬆️ 四对一连接（合并）

5. AI图片生成 → 格式化结果

6. 格式化结果 → 回调后端API

7. 回调后端API → 返回成功响应
```

### 连线图

```
                     ┌─→ 判断1:1 → 1:1尺寸 ─┐
                     │                     │
Webhook触发器 → 解析参数 ├─→ 判断3:4 → 3:4尺寸 ─┼─→ AI生成 → 格式化 → 回调 → 响应
                     │                     │
                     ├─→ 判断16:9 → 16:9尺寸 ─┤
                     │                     │
                     └─→ 判断9:16 → 9:16尺寸 ─┘
```

### 详细连线步骤

**步骤1：连接触发器**

```
从 "Webhook触发器" 的右侧输出点
  → 拖拽到
"解析请求参数" 的左侧输入点
```

**步骤2：连接4个比例判断（并行）**

```
从 "解析请求参数" 的右侧输出点
  → 拖拽4次到以下4个节点：
    1. "判断是否1:1" 的左侧输入点
    2. "判断是否3:4" 的左侧输入点
    3. "判断是否16:9" 的左侧输入点
    4. "判断是否9:16" 的左侧输入点
```

**步骤3：连接尺寸设置（每个判断的YES分支）**

```
从 "判断是否1:1" 的右侧绿色输出点（YES）
  → 拖拽到 "1:1尺寸" 的左侧输入点

从 "判断是否3:4" 的右侧绿色输出点（YES）
  → 拖拽到 "3:4尺寸" 的左侧输入点

从 "判断是否16:9" 的右侧绿色输出点（YES）
  → 拖拽到 "16:9尺寸" 的左侧输入点

从 "判断是否9:16" 的右侧绿色输出点（YES）
  → 拖拽到 "9:16尺寸" 的左侧输入点
```

**步骤4：合并到AI生成（4对1）**

```
从 "1:1尺寸" 的右侧输出点
  → 拖拽到 "AI图片生成" 的左侧输入点

从 "3:4尺寸" 的右侧输出点
  → 拖拽到 "AI图片生成" 的左侧输入点

从 "16:9尺寸" 的右侧输出点
  → 拖拽到 "AI图片生成" 的左侧输入点

从 "9:16尺寸" 的右侧输出点
  → 拖拽到 "AI图片生成" 的左侧输入点
```

**步骤5-7：后续处理（线性）**

```
从 "AI图片生成" → "格式化结果"
从 "格式化结果" → "回调后端API"
从 "回调后端API" → "返回成功响应"
```

---

## ✅ 工作流2：飞书触发v2（20个节点）

### 节点列表

| 节点ID                        | 节点名称          | 位置说明            |
| ----------------------------- | ----------------- | ------------------- |
| node-feishu-trigger           | Webhook触发器     | 起点（v2用Webhook） |
| node-read-record              | 读取飞书记录      | 读取数据            |
| node-extract-params           | 提取参数          | 参数提取            |
| node-update-status-processing | 更新状态为处理中  | 状态更新1           |
| node-download-product         | 下载商品图片      | 下载图1             |
| node-check-scene              | 判断是否有场景图  | IF判断              |
| node-download-scene           | 下载场景图        | 下载图2（可选）     |
| node-binary-process           | 二进制数据处理    | 关键节点            |
| node-set-image-urls           | 设置图片URL和参数 | 参数整理            |
| node-check-1to1               | 判断是否1:1       | 比例判断1           |
| node-check-3to4               | 判断是否3:4       | 比例判断2           |
| node-check-16to9              | 判断是否16:9      | 比例判断3           |
| node-check-9to16              | 判断是否9:16      | 比例判断4           |
| node-size-1to1                | 1:1尺寸           | 尺寸设置1           |
| node-size-3to4                | 3:4尺寸           | 尺寸设置2           |
| node-size-16to9               | 16:9尺寸          | 尺寸设置3           |
| node-size-9to16               | 9:16尺寸          | 尺寸设置4           |
| node-ai-generate              | AI图片生成        | 核心节点            |
| node-format-result            | 格式化结果        | 结果格式化          |
| node-update-feishu-record     | 更新飞书记录      | 状态更新2           |
| node-webhook-response         | 返回成功响应      | 终点                |

### 连线顺序

```
1. Webhook触发器 → 读取飞书记录

2. 读取飞书记录 → 提取参数

3. 提取参数 → 更新状态为处理中

4. 更新状态为处理中 → 下载商品图片

5. 下载商品图片 → 判断是否有场景图

6. 判断是否有场景图 → 下载场景图（YES分支）
   判断是否有场景图 → 二进制数据处理（NO分支）
   ⬆️ 分支连接

7. 下载场景图 → 二进制数据处理
   ⬆️ 合并连接

8. 二进制数据处理 → 设置图片URL和参数

9. 设置图片URL和参数 → 判断是否1:1
   设置图片URL和参数 → 判断是否3:4
   设置图片URL和参数 → 判断是否16:9
   设置图片URL和参数 → 判断是否9:16
   ⬆️ 一对四连接（并行）

10. 判断是否1:1 → 1:1尺寸（YES分支）
    判断是否3:4 → 3:4尺寸（YES分支）
    判断是否16:9 → 16:9尺寸（YES分支）
    判断是否9:16 → 9:16尺寸（YES分支）

11. 1:1尺寸 → AI图片生成
    3:4尺寸 → AI图片生成
    16:9尺寸 → AI图片生成
    9:16尺寸 → AI图片生成
    ⬆️ 四对一连接（合并）

12. AI图片生成 → 格式化结果

13. 格式化结果 → 更新飞书记录

14. 更新飞书记录 → 返回成功响应
```

### 连线图

```
Webhook触发器 → 读取记录 → 提取参数 → 更新状态 → 下载商品图
                                                      ↓
                                              判断是否有场景图
                                                    ↓       ↓
                                                  YES      NO
                                                    ↓       ↓
                                              下载场景图   二进制处理
                                                    ↓       ↓
                                                    └──→ 设置参数
                                                          ↓
                                        ┌─→ 判断1:1 → 1:1尺寸 ─┐
                                        │                     │
                                  ┌─→ 判断3:4 → 3:4尺寸 ─┼─→ AI生成 → 格式化 → 更新 → 响应
                                        │                     │
                                  └─→ 判断16:9 → 16:9尺寸 ─┤
                                                            │
                                  └─→ 判断9:16 → 9:16尺寸 ──┘
```

### 详细连线步骤

**步骤1：触发和读取（线性）**

```
Webhook触发器 → 读取飞书记录
读取飞书记录 → 提取参数
提取参数 → 更新状态为处理中
更新状态为处理中 → 下载商品图片
```

**步骤2：场景图判断分支**

```
下载商品图片 → 判断是否有场景图

判断是否有场景图 → 下载场景图（从绿色YES输出点）
判断是否有场景图 → 二进制数据处理（从红色NO输出点）
```

**步骤3：合并场景图分支**

```
下载场景图 → 二进制数据处理
```

**步骤4-14：与前端工作流类似**

```
二进制数据处理 → 设置图片URL和参数
设置图片URL和参数 → 4个比例判断（并行）
4个比例判断 → 4个尺寸设置（YES分支）
4个尺寸设置 → AI图片生成（合并）
AI图片生成 → 格式化结果
格式化结果 → 更新飞书记录
更新飞书记录 → 返回成功响应
```

---

## 🔧 连线技巧

### 技巧1：识别节点输出

```
节点右侧的输出点：
- 绿色圆点 = YES/True分支
- 红色圆点 = NO/False分支
- 蓝色圆点 = 正常输出
```

### 技巧2：一对多连接

```
从一个节点拖拽到多个节点：
1. 点击第一个输出点
2. 拖拽到第一个目标节点
3. 松开鼠标
4. 重复步骤1-3连接其他节点
```

### 技巧3：多对一连接

```
从多个节点拖拽到一个节点：
1. 点击第一个节点的输出点
2. 拖拽到目标节点
3. 松开鼠标
4. 重复步骤1-3连接其他节点
```

### 技巧4：检查连接

```
验证连接是否正确：
1. 点击任意节点
2. 查看输入/输出连线
3. 确认连线数量正确
4. 确认连线方向正确
```

---

## ✅ 连线验证

### 验证工作流1（前端）

**连接数量检查**:

```
Webhook触发器: 1条输出
解析请求参数: 1条输入 + 4条输出
4个判断节点: 各1条输入 + 1条输出（YES分支）
4个尺寸节点: 各1条输入 + 1条输出
AI图片生成: 4条输入 + 1条输出
格式化结果: 1条输入 + 1条输出
回调后端API: 1条输入 + 1条输出
返回成功响应: 1条输入
```

### 验证工作流2（飞书v2）

**连接数量检查**:

```
Webhook触发器: 1条输出
读取飞书记录: 1条输入 + 1条输出
提取参数: 1条输入 + 1条输出
更新状态为处理中: 1条输入 + 1条输出
下载商品图片: 1条输入 + 1条输出
判断是否有场景图: 1条输入 + 2条输出（YES和NO）
下载场景图: 1条输入 + 1条输出
二进制数据处理: 2条输入 + 1条输出
设置图片URL和参数: 1条输入 + 4条输出
4个判断节点: 各1条输入 + 1条输出（YES分支）
4个尺寸节点: 各1条输入 + 1条输出
AI图片生成: 4条输入 + 1条输出
格式化结果: 1条输入 + 1条输出
更新飞书记录: 1条输入 + 1条输出
返回成功响应: 1条输入
```

---

## ❓ 常见问题

### Q1: 导入后节点位置散乱但有线连接？

**A**: 这是正常的，不影响功能。可以手动拖拽调整位置。

### Q2: 导入后没有线连接？

**A**: 按照本指南手动连线即可。

### Q3: 如何确认连线是否正确？

**A**:

1. 点击任意节点
2. 查看左侧的连线列表
3. 确认连接的节点和方向

### Q4: 连线时如何区分YES和NO分支？

**A**:

- 绿色输出点 = YES分支
- 红色输出点 = NO分支
- 蓝色输出点 = 正常输出

### Q5: 连错了怎么办？

**A**:

1. 点击连线
2. 按Delete键删除
3. 重新连接

---

## 🎯 完成标志

### 工作流1（前端）

- ✅ 14个节点全部连接
- ✅ 没有孤立的节点
- ✅ 流程从Webhook触发器开始
- ✅ 流程在返回成功响应结束
- ✅ 4个并行分支正确连接

### 工作流2（飞书v2）

- ✅ 20个节点全部连接
- ✅ 没有孤立的节点
- ✅ 流程从Webhook触发器开始
- ✅ 流程在返回成功响应结束
- ✅ 场景图分支正确连接
- ✅ 4个并行分支正确连接

---

**完成时间**: 预计10-15分钟
**难度**: 中等
**建议**: 先完成工作流1，再完成工作流2

祝连线顺利！🎊
