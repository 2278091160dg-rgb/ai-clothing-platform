# 🚀 AI服装平台 - 详细开发Todolist

## 📅 创建日期：2026-01-29

---

## 🎯 开发策略：先拉通前端生图链路，再完善数据存储

### 为什么这样分阶段？

```
阶段1: 前端生图链路 ✅ 优先
用户 → 前端 → N8N → DeerAPI → 前端显示结果
↓
阶段2: 数据存储链路 ⏰ 后续
N8N → 飞书记录 → 数据库

好处：
✅ 先验证核心功能能否工作
✅ 快速获得用户反馈
✅ 降低风险，减少返工
```

---

## 📊 完整开发Todolist

### 🥇 第一阶段：前端生图链路（优先）

**目标**：拉通前端→N8N→DeerAPI→前端回调
**预计**：20小时

#### 1.1 提示词模板系统（4小时）

- [ ] **任务1**: 优化场景生图提示词模板（2小时）
  - 文件：`src/lib/prompts/templates/scene-generation.template.ts`
  - 内容：100+参数，结构化提示词
  - 依赖：无

- [ ] **任务4**: 创建虚拟试衣提示词模板（1小时）
  - 文件：`src/lib/prompts/templates/virtual-tryon.template.ts`
  - 内容：试衣提示词，服装/参考图参数
  - 依赖：无

- [ ] **任务9**: 创建智能穿戴提示词模板（0.5小时）
  - 文件：`src/lib/prompts/templates/smart-wearing.template.ts`
  - 内容：穿戴提示词，商品类型参数
  - 依赖：无

- [ ] **任务10**: 创建自由搭配提示词模板（0.5小时）
  - 文件：`src/lib/prompts/templates/free-combination.template.ts`
  - 内容：搭配提示词，多素材参数
  - 依赖：无

**交付物**：

- ✅ 4个提示词模板文件
- ✅ 完整的参数接口定义
- ✅ 提示词构建函数

---

#### 1.2 前端界面重构（5小时）

- [ ] **任务3**: 前端界面重构 - 添加模式选择器（3小时）
  - 文件：
    - `src/components/ModeSelector.tsx` (新建)
    - `src/components/forms/SceneForm.tsx` (重构)
    - `src/components/forms/VirtualTryOnForm.tsx` (新建)
  - 内容：4种模式选择，动态表单切换
  - 依赖：无

- [ ] **任务11**: 实现智能穿戴前端表单（1小时）
  - 文件：`src/components/forms/SmartWearingForm.tsx`
  - 内容：穿戴表单，商品类型选择
  - 依赖：任务3（模式选择器）

- [ ] **任务12**: 实现自由搭配前端表单（1小时）
  - 文件：`src/components/forms/FreeCombinationForm.tsx`
  - 内容：搭配表单，多文件上传
  - 依赖：任务3（模式选择器）

**交付物**：

- ✅ 模式选择器组件
- ✅ 4个表单组件
- ✅ 平滑切换动画

---

#### 1.3 AI对话优化功能（3小时）

- [ ] **任务2**: 添加AI对话优化功能到前端（3小时）
  - 文件：
    - `src/components/AIConversationModal.tsx` (新建)
    - `src/app/api/conversations/route.ts` (新建)
  - 内容：AI对话弹窗，对话历史，版本选择
  - 依赖：无

**交付物**：

- ✅ AI对话弹窗
- ✅ 对话API接口
- ✅ 版本选择功能

---

#### 1.4 API接口扩展（3小时）

- [ ] **任务5**: 扩展API接口支持多模式（3小时）
  - 文件：`src/app/api/tasks/route.ts`
  - 内容：
    - 添加mode参数
    - 实现模式路由逻辑
    - 4个handler函数
  - 依赖：任务1,4,9,10（提示词模板）

**交付物**：

- ✅ 更新的API接口
- ✅ 模式路由逻辑
- ✅ 参数验证

---

#### 1.5 N8N工作流更新（5小时）

- [ ] **任务6**: 更新N8N工作流支持模式分发（5小时）
  - 文件：`docs/n8n-workflow-v2.json`
  - 内容：
    - 添加mode解析
    - 添加模式分发节点
    - 4个提示词构建分支
    - 统一DeerAPI调用
  - 依赖：任务5（API接口）

**交付物**：

- ✅ 更新的N8N工作流JSON
- ✅ 4个生成分支
- ✅ 导入和测试说明

---

### 🥈 第二阶段：数据存储链路（后续）

**目标**：完善飞书记录和数据库存储
**预计**：8小时

#### 2.1 飞书多维表格扩展（3小时）

- [ ] **任务7**: 扩展飞书多维表格字段（3小时）
  - 交付物：
    - ✅ 飞书字段配置说明
    - ✅ 5个新字段定义
    - ✅ 配置教程更新
  - 依赖：第一阶段完成

---

#### 2.2 数据库Schema更新（2小时）

- [ ] **任务8**: 更新数据库Schema支持多模式（2小时）
  - 文件：`prisma/schema.prisma`
  - 内容：
    - 添加mode字段
    - 添加4个模式相关字段
    - 创建迁移文件
  - 依赖：第一阶段完成

**交付物**：

- ✅ 更新的schema.prisma
- ✅ 数据库迁移文件
- ✅ 迁移说明

---

#### 2.3 N8N飞书记录逻辑（3小时）

- [ ] **任务13**: 完善飞书记录创建逻辑（3小时）
  - 内容：
    - 更新"创建飞书记录"节点
    - 根据mode添加不同字段
    - 测试验证
  - 依赖：任务7（飞书字段）

**交付物**：

- ✅ 更新的N8N节点
- ✅ 字段映射说明
- ✅ 测试验证

---

## 📅 开发时间表

### Week 1: 第一阶段（前端生图链路）

| 天数  | 任务                  | 工作量 | 状态      |
| ----- | --------------------- | ------ | --------- |
| Day 1 | 提示词模板系统（4个） | 4小时  | ⏳ 待开始 |
| Day 2 | 前端界面重构          | 5小时  | ⏳ 待开始 |
| Day 3 | AI对话优化 + API扩展  | 6小时  | ⏳ 待开始 |
| Day 4 | N8N工作流更新         | 5小时  | ⏳ 待开始 |
| Day 5 | 测试验证              | 4小时  | ⏳ 待开始 |

**Week 1 目标**：

- ✅ 前端→N8N→DeerAPI→前端回调解通
- ✅ 4种模式都可以生成图片
- ✅ 用户可以体验完整功能

---

### Week 2: 第二阶段（数据存储链路）

| 天数     | 任务             | 工作量 | 状态      |
| -------- | ---------------- | ------ | --------- |
| Day 6    | 飞书多维表格扩展 | 3小时  | ⏳ 待开始 |
| Day 7    | 数据库Schema更新 | 2小时  | ⏳ 待开始 |
| Day 8    | N8N飞书记录逻辑  | 3小时  | ⏳ 待开始 |
| Day 9-10 | 测试和优化       | 8小时  | ⏳ 待开始 |

**Week 2 目标**：

- ✅ 所有生成记录保存到飞书
- ✅ 数据库完整记录
- ✅ 系统生产就绪

---

## 🎯 关键里程碑

### 里程碑1：场景生图优化完成（Day 1）

**标志**：

- ✅ 场景生图使用100+参数
- ✅ 生成质量明显提升
- ✅ AI对话优化可用

**验证**：

- 上传商品图
- 选择参数（材质、光线、背景等）
- 生成图片
- 质量评估

---

### 里程碑2：虚拟试衣功能上线（Day 4）

**标志**：

- ✅ 前端可以切换到"虚拟试衣"模式
- ✅ 上传服装图+参考图
- ✅ 生成试衣效果

**验证**：

- 选择"虚拟试衣"模式
- 上传服装图
- 上传参考图
- 生成试衣图片
- 评估效果

---

### 里程碑3：前端生图链路打通（Day 5）

**标志**：

- ✅ 4种模式都能生成图片
- ✅ 前端→N8N→DeerAPI→前端回调解通
- ✅ 基本功能可用

**验证**：

- 测试场景生图
- 测试虚拟试衣
- 测试智能穿戴
- 测试自由搭配
- 全流程通过

---

### 里程碑4：数据存储链路打通（Day 10）

**标志**：

- ✅ 所有记录保存到飞书
- ✅ 数据库完整记录
- ✅ 系统生产就绪

**验证**：

- 生成图片后检查飞书
- 确认字段完整
- 确认数据正确

---

## 📋 依赖关系图

```
提示词模板 ──────┐
                 ├──→ API接口 ───→ N8N工作流 ──→ 第一阶段完成
前端界面 ────────┘          ↑
                        前端生图链路

                                ↓
飞书字段 ──→ N8N飞书节点 ──→ 第二阶段完成
数据库Schema ──────┘        ↑
                        数据存储链路
```

---

## ⚠️ 开发过程中的关键提醒

### 提醒1：不要跳过提示词模板

**原因**：提示词是核心，所有功能都依赖它

**检查点**：

- [ ] 4个提示词模板都创建完成
- [ ] 每个模板都有完整参数接口
- [ ] 每个模板都有使用示例

---

### 提醒2：先测试场景生图，再做其他

**原因**：场景生图最简单，先验证基础链路

**检查点**：

- [ ] 场景生图可以正常生成
- [ ] 提示词正确传递到N8N
- [ ] N8N正确调用DeerAPI
- [ ] 结果正确返回前端

---

### 提醒3：逐步启用模式，不要一次性全部启用

**原因**：降低风险，便于调试

**启用顺序**：

1. ✅ 场景生图（已有，先优化）
2. ✅ 虚拟试衣（核心功能）
3. ✅ 智能穿戴（基于试衣）
4. ✅ 自由搭配（最后启用）

---

### 提醒4：N8N工作流更新后必须测试

**原因**：N8N是核心，错误会影响所有功能

**测试清单**：

- [ ] mode参数正确解析
- [ ] 4个分支正确分发
- [ ] 每个分支的提示词正确
- [ ] DeerAPI调用成功
- [ ] 结果正确返回

---

### 提醒5：飞书记录可以最后添加

**原因**：数据存储不影响核心功能

**时机**：前端生图链路完全打通后

---

## 🎯 现在开始第一阶段开发

### 第一步：创建提示词模板

**现在开始**：

1. 优化场景生图提示词模板
2. 创建虚拟试衣提示词模板
3. 创建智能穿戴提示词模板
4. 创建自由搭配提示词模板

**预计完成时间**：4小时

**完成后可以**：

- 验证提示词质量
- 调整参数定义
- 继续下一步

---

## 📞 进度跟踪

**当前状态**：⏳ 准备开始

**下一步**：创建场景生图提示词模板

**预计完成**：Day 5（第一阶段），Day 10（全部）

**我会不断提醒您当前进度和下一步！**
