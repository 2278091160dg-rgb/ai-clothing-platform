# 🧪 模式选择器功能测试流程

## 测试环境

- 浏览器: http://localhost:3000
- 开发服务器: 运行中
- 数据库: Supabase PostgreSQL

---

## 📋 测试用例

### 测试1: 模式选择器UI显示 ✅

**步骤：**

1. 访问 http://localhost:3000
2. 输入VIP密码登录
3. 进入主工作区页面
4. 查看生成参数面板顶部

**预期结果：**

```
✅ 看到"📷 选择生成模式"标题
✅ 显示4个模式卡片：
   - 🏞️ 场景生图 (商品+场景图生成)
   - 👔 虚拟试衣 (服装上身试穿)
   - 👟 智能穿戴 (鞋包配饰穿戴) - 显示"开发中"标签，灰色禁用
   - 🎨 自由搭配 (多素材组合生图) - 显示"开发中"标签，灰色禁用
✅ 默认选中"场景生图"模式（紫色边框+渐变背景）
```

**截图位置：** `docs/测试截图/01-模式选择器UI.png`

---

### 测试2: 模式切换 - 场景生图 → 虚拟试衣 ✅

**步骤：**

1. 确保当前选中"场景生图"
2. 输入提示词：`"时尚模特在咖啡厅"`
3. 点击"👔 虚拟试衣"按钮

**预期结果：**

```
✅ 模式切换到"虚拟试衣"（紫色高亮）
✅ 提示词被清空
✅ 提示词占位符变为："描述服装款式、颜色、材质..."
✅ 上传面板标签：
   - 左侧：模特图片
   - 右侧：服装图片
✅ 生成按钮文字变为："开始虚拟试衣"
```

**截图位置：** `docs/测试截图/02-切换到虚拟试衣.png`

---

### 测试3: 模式切换 - 虚拟试衣 → 场景生图 ✅

**步骤：**

1. 在"虚拟试衣"模式下
2. 输入提示词：`"红色连衣裙"`
3. 点击"🏞️ 场景生图"按钮

**预期结果：**

```
✅ 模式切换回"场景生图"
✅ 提示词被清空
✅ 提示词占位符变为："描述场景氛围、风格、构图..."
✅ 上传面板标签：
   - 左侧：商品图片
   - 右侧：场景图片
✅ 生成按钮文字变为："开始生成"
```

**截图位置：** `docs/测试截图/03-切换回场景生图.png`

---

### 测试4: 禁用模式点击测试 ✅

**步骤：**

1. 尝试点击"👟 智能穿戴"按钮

**预期结果：**

```
✅ 按钮无响应（不切换）
✅ 鼠标悬停显示 `not-allowed` 光标
✅ 显示"开发中"橙色标签
```

---

### 测试5: 完整提交流程测试 🚀

**步骤：**

1. 选择"场景生图"模式
2. 上传商品图片（左侧）
3. 上传场景图片（右侧）
4. 输入提示词：`"时尚模特在现代咖啡厅，柔和光线"
5. 选择AI模型：FLUX.1
6. 选择宽高比：1:1
7. 选择生成数量：4
8. 点击"开始生成"按钮

**预期结果：**

```
✅ 按钮变为加载状态
✅ 显示"生成中..."提示
✅ 任务创建成功（在任务列表中显示）
✅ 检查网络请求：
   - POST /api/tasks
   - body包含 mode: "scene"
```

**验证方式：**

```javascript
// 浏览器Console执行
fetch('/api/tasks', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    mode: 'scene',
    productImageUrl: 'xxx',
    prompt: '测试提示词',
  }),
});
```

**截图位置：** `docs/测试截图/05-任务提交成功.png`

---

### 测试6: 数据库验证 ✅

**步骤：**

1. 打开 Supabase Table Editor
2. 查看 `tasks` 表
3. 查看最新创建的记录

**预期结果：**

```sql
SELECT id, mode, prompt, status, created_at
FROM tasks
ORDER BY created_at DESC
LIMIT 1;

-- 预期结果：
-- mode = 'scene'
-- status = 'PENDING'
-- prompt = '时尚模特在现代咖啡厅，柔和光线'
```

**截图位置：** `docs/测试截图/06-数据库记录.png`

---

### 测试7: 虚拟试衣模式提交测试 🚀

**步骤：**

1. 切换到"虚拟试衣"模式
2. 上传模特图片（左侧）
3. 上传服装图片（右侧）
4. 输入提示词：`"红色连衣裙，优雅气质"
5. 点击"开始虚拟试衣"

**预期结果：**

```
✅ 网络请求包含 mode: "tryon"
✅ 数据库新记录 mode = 'tryon'
✅ N8N工作流接收mode参数
```

**N8N Webhook验证：**

```json
{
  "mode": "tryon",
  "taskId": "xxx",
  "userId": "default-user",
  "modelImage": "模特图片URL",
  "clothingImage": "服装图片URL",
  "prompt": "红色连衣裙，优雅气质"
}
```

**截图位置：** `docs/测试截图/07-虚拟试衣提交.png`

---

## 🐛 问题记录模板

如果发现问题，请记录：

```markdown
### 问题 #1

**测试用例：** 测试X
**实际结果：** 描述实际发生的情况
**预期结果：** 描述应该发生的情况
**截图：** 附上截图
**浏览器Console错误：** 粘贴错误信息
**网络请求：** 附上Request/Response
```

---

## ✅ 测试完成检查清单

- [ ] 测试1: UI显示正常
- [ ] 测试2: 场景→虚拟试衣切换
- [ ] 测试3: 虚拟试衣→场景切换
- [ ] 测试4: 禁用模式无响应
- [ ] 测试5: 场景生图提交成功
- [ ] 测试6: 数据库mode字段正确
- [ ] 测试7: 虚拟试衣提交成功

---

_测试创建时间: 2026-01-29_
_测试人员: [待填写]_
_测试状态: 进行中_
