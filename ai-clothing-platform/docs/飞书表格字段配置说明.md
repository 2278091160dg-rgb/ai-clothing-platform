# 飞书多维表格字段配置说明

## 版本：v1.0

本文档说明需要在飞书多维表格中添加/修改的字段配置。

---

## 新增字段（必须添加）

### 1. 数据来源

**字段类型**: 单选
**字段名称**: 数据来源
**字段ID**: `dataSource`
**是否必填**: 是
**默认值**: 🌐 前端用户

**选项**:
| 选项名称 | 选项值 | 图标 |
|---------|--------|------|
| 前端用户 | `frontend` | 🌐 |
| 飞书用户 | `feishu` | 📊 |
| API自动 | `api` | 🤖 |

**配置说明**:
```
1. 字段类型选择"单选"
2. 添加3个选项，使用对应的图标和值
3. 设置默认值为"🌐 前端用户"
4. 字段权限：只读（由系统自动填充）
```

---

### 2. 同步状态

**字段类型**: 单选
**字段名称**: 同步状态
**字段ID**: `syncStatus`
**是否必填**: 是
**默认值**: 🔄 同步中

**选项**:
| 选项名称 | 选项值 | 图标 | 说明 |
|---------|--------|------|------|
| 已同步 | `synced` | ✅ | 数据已同步到飞书 |
| 同步中 | `syncing` | 🔄 | 正在同步 |
| 冲突 | `conflict` | ⚠️ | 检测到数据冲突 |
| 失败 | `failed` | ❌ | 同步失败 |

**配置说明**:
```
1. 字段类型选择"单选"
2. 添加4个选项，使用对应的图标和值
3. 设置默认值为"🔄 同步中"
4. 字段权限：只读（由系统自动更新）
```

---

### 3. 前端用户ID

**字段类型**: 文本
**字段名称**: 前端用户ID
**字段ID**: `frontendUserId`
**是否必填**: 否
**默认值**: 无

**配置说明**:
```
1. 字段类型选择"文本"
2. 字段权限：只读（由系统自动填充）
3. 用于区分不同的前端用户
```

---

### 4. 最后修改者

**字段类型**: 文本
**字段名称**: 最后修改者
**字段ID**: `lastModifiedBy`
**是否必填**: 否
**默认值**: 无

**配置说明**:
```
1. 字段类型选择"文本"
2. 字段权限：只读（由系统自动填充）
3. 值格式：🌐 前端用户 / 📊 飞书用户 / 🤖 API自动
```

---

### 5. 最后修改时间

**字段类型**: 日期时间
**字段名称**: 最后修改时间
**字段ID**: `lastModifiedAt`
**是否必填**: 否
**默认值**: 当前时间

**配置说明**:
```
1. 字段类型选择"日期时间"
2. 字段权限：只读（由系统自动更新）
3. 格式：YYYY-MM-DD HH:mm:ss
```

---

## 现有字段（无需修改）

以下字段已存在，不需要修改：

| 字段名称 | 字段ID | 类型 | 说明 |
|---------|--------|------|------|
| 提示词 | `prompt` | 文本 | 最终使用的提示词 |
| 原始提示词 | `originalPrompt` | 文本 | 用户输入的原始提示词 |
| 优化后提示词 | `optimizedPrompt` | 文本 | AI优化后的提示词 |
| 状态 | `status` | 单选 | 任务状态 |
| 进度 | `progress` | 数字 | 生成进度 |
| 商品图片 | `productImage` | 附件 | 商品图片 |
| 场景图 | `sceneImage` | 附件 | 场景图片 |
| AI模型 | `aiModel` | 单选 | AI模型选择 |
| 尺寸比例 | `aspectRatio` | 单选 | 图片比例 |
| 生成张数 | `imageCount` | 数字 | 生成张数 |
| 清晰度 | `quality` | 单选 | 清晰度 |
| 创建时间 | `createdAt` | 日期时间 | 创建时间 |

---

## 条件格式配置（推荐添加）

### 高亮"同步中"的记录

```
条件：
  同步状态 = "🔄 同步中"

格式：
  背景颜色：#DBEAFE（浅蓝色）
  边框颜色：#3B82F6
  边框宽度：2px
```

### 高亮"冲突"的记录

```
条件：
  同步状态 = "⚠️ 冲突"

格式：
  背景颜色：#FEE2E2（浅红色）
  边框颜色：#EF4444
  边框宽度：2px
  文字颜色：#DC2626
```

### 高亮"同步失败"的记录

```
条件：
  同步状态 = "❌ 失败"

格式：
  背景颜色：#FEE2E2（浅红色）
  文字颜色：#DC2626
```

---

## 字段联动配置（可选）

### 场景1：前端用户修改提示词

```
触发条件：
  数据来源 = "🌐 前端用户"
  且 "提示词"字段被修改

执行动作：
  1. 更新"同步状态"为"🔄 同步中"
  2. 记录操作日志
```

### 场景2：同步完成

```
触发条件：
  "同步状态"从"🔄 同步中"变为"✅ 已同步"

执行动作：
  无（仅状态变更）
```

---

## 自动化配置（可选）

### AI优化按钮

如果需要支持飞书端的AI优化功能：

```
触发器：按钮点击
  字段：AI优化按钮

动作1：调用API
  方法：POST
  URL：https://your-app.com/api/feishu/optimize-prompt
  Body：
    {
      "record_id": "{{record_id}}",
      "prompt": "{{提示词}}"
    }

动作2：更新字段
  字段：优化后提示词
  值：{{response.optimized}}

动作3：发送通知
  内容：提示词已优化完成
```

---

## 完整字段清单

### 基础字段

| 字段名称 | 字段ID | 类型 | 必填 | 默认值 | 权限 |
|---------|--------|------|------|--------|------|
| 提示词 | `prompt` | 文本 | 是 | - | 可编辑 |
| 状态 | `status` | 单选 | 是 | 待处理 | 可编辑 |
| 进度 | `progress` | 数字 | 否 | 0 | 只读 |
| 商品图片 | `productImage` | 附件 | 是 | - | 可编辑 |
| 场景图 | `sceneImage` | 附件 | 否 | - | 可编辑 |
| AI模型 | `aiModel` | 单选 | 是 | FLUX.1 | 可编辑 |
| 尺寸比例 | `aspectRatio` | 单选 | 是 | 1:1 | 可编辑 |
| 生成张数 | `imageCount` | 数字 | 是 | 4 | 可编辑 |
| 清晰度 | `quality` | 单选 | 是 | high | 可编辑 |

### 提示词优化字段

| 字段名称 | 字段ID | 类型 | 必填 | 默认值 | 权限 |
|---------|--------|------|------|--------|------|
| 原始提示词 | `originalPrompt` | 文本 | 否 | - | 可编辑 |
| 优化后提示词 | `optimizedPrompt` | 文本 | 否 | - | 只读 |
| AI优化按钮 | `optimizeButton` | 按钮 | 否 | - | 可点击 |

### 同步和状态字段

| 字段名称 | 字段ID | 类型 | 必填 | 默认值 | 权限 |
|---------|--------|------|------|--------|------|
| 数据来源 | `dataSource` | 单选 | 是 | 🌐 前端用户 | 只读 |
| 同步状态 | `syncStatus` | 单选 | 是 | 🔄 同步中 | 只读 |
| 前端用户ID | `frontendUserId` | 文本 | 否 | - | 只读 |
| 最后修改者 | `lastModifiedBy` | 文本 | 否 | - | 只读 |
| 最后修改时间 | `lastModifiedAt` | 日期时间 | 否 | 当前时间 | 只读 |

### 元数据字段

| 字段名称 | 字段ID | 类型 | 必填 | 默认值 | 权限 |
|---------|--------|------|------|--------|------|
| 记录ID | `record_id` | 文本 | 是 | - | 只读 |
| 创建时间 | `createdAt` | 日期时间 | 是 | - | 只读 |

---

## 字段权限配置建议

| 用户角色 | 基础字段 | 提示词优化字段 | 同步状态字段 | 元数据字段 |
|---------|---------|--------------|-------------|-----------|
| 飞书用户 | 可编辑 | 可编辑 | 只读 | 只读 |
| 前端用户 | - | - | - | - |
| 系统API | 可更新 | 可更新 | 可更新 | 可更新 |

---

## 实施步骤

### Step 1: 添加新字段（5分钟）

1. 打开飞书多维表格
2. 点击"添加字段"
3. 依次添加：
   - 数据来源（单选）
   - 同步状态（单选）
   - 前端用户ID（文本）
   - 最后修改者（文本）
   - 最后修改时间（日期时间）

### Step 2: 配置选项（5分钟）

1. 配置"数据来源"字段的选项
2. 配置"同步状态"字段的选项
3. 设置默认值

### Step 3: 配置条件格式（可选，5分钟）

1. 进入"格式"设置
2. 添加3个条件格式规则
3. 设置对应的背景和边框颜色

### Step 4: 配置自动化（可选，10分钟）

1. 添加"AI优化按钮"
2. 配置自动化流程
3. 测试按钮功能

---

## 验证清单

- [ ] 5个新增字段已添加
- [ ] "数据来源"字段有3个选项，默认值为"🌐 前端用户"
- [ ] "同步状态"字段有4个选项，默认值为"🔄 同步中"
- [ ] "前端用户ID"、"最后修改者"、"最后修改时间"为只读
- [ ] 条件格式已配置（可选）
- [ ] AI优化按钮已配置（可选）

---

## 字段映射关系

### 前端 ↔ 飞书字段映射

| 前端字段 | 飞书字段 | 类型 |
|---------|---------|------|
| `prompt` | `提示词` | 文本 |
| `originalPrompt` | `原始提示词` | 文本 |
| `optimizedPrompt` | `优化后提示词` | 文本 |
| `promptSource` | `数据来源` | 单选 |
| `status` | `状态` | 单选 |
| `progress` | `进度` | 数字 |
| `syncStatus` | `同步状态` | 单选 |
| `lastModifiedBy` | `最后修改者` | 文本 |
| `lastModifiedAt` | `最后修改时间` | 日期时间 |

### 枚举值映射

#### PromptSource
| 前端值 | 飞书显示 |
|--------|---------|
| `USER` | 🌐 前端用户 |
| `AI_OPTIMIZED` | 🌐 前端用户 |
| `FEISHU` | 📊 飞书用户 |

#### TaskSyncStatus
| 前端值 | 飞书显示 |
|--------|---------|
| `PENDING` | 🔄 同步中 |
| `SYNCING` | 🔄 同步中 |
| `SYNCED` | ✅ 已同步 |
| `FAILED` | ❌ 失败 |
