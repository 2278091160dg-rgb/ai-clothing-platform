# 飞书多维表格 - 完整配置教程

## 📋 文档信息

- **版本**: v2.0
- **更新日期**: 2026-01-29
- **适用对象**: 技术管理员、系统配置人员
- **预计配置时间**: 15-20分钟

---

## 📖 目录

1. [配置前准备](#1-配置前准备)
2. [13个必需字段详解](#2-13个必需字段详解)
3. [字段配置截图说明](#3-字段配置截图说明)
4. [AI对话URL配置](#4-ai对话url配置)
5. [自动化配置步骤](#5-自动化配置步骤)
6. [权限与格式设置](#6-权限与格式设置)
7. [验证清单](#7-验证清单)
8. [常见问题](#8-常见问题)

---

## 1. 配置前准备

### 1.1 获取必要信息

在开始配置前，请准备以下信息：

| 信息项         | 说明                   | 获取方式        |
| -------------- | ---------------------- | --------------- |
| **App Token**  | 飞书多维表格的唯一标识 | 从表格URL中获取 |
| **Table ID**   | 数据表的唯一标识       | 从表格URL中获取 |
| **App ID**     | 飞书应用ID             | 飞书开放平台    |
| **App Secret** | 飞书应用密钥           | 飞书开放平台    |

### 1.2 获取App Token和Table ID

1. 打开你的飞书多维表格
2. 查看浏览器地址栏，格式如下：
   ```
   https://xxx.feishu.cn/base/app_abc123def456/?table=tbl_xyz789
   ```
3. **App Token** = `app_abc123def456`
4. **Table ID** = `tbl_xyz789`

### 1.3 创建飞书应用（如未创建）

1. 访问 [飞书开放平台](https://open.feishu.cn)
2. 创建"企业自建应用"
3. 配置权限：
   - `bitable:app` - 获取多维表格信息
   - `bitable:app:readonly` - 读取多维表格
   - `bitable:app:write` - 写入多维表格
4. 获取 App ID 和 App Secret

---

## 2. 13个必需字段详解

### 字段1：用户ID

**基本信息**

```
字段类型: 文本
字段名称: 用户ID
字段ID: userId
是否必填: 否
默认值: 无
```

**配置说明**

- 用于标识创建任务的用户
- 系统自动填充，用户无需手动输入
- 权限设置：只读

**数据格式**

```
示例: user_1234567890
格式: uuid 或 自定义用户ID
```

**用途**

- 区分不同用户的任务
- 统计用户使用量
- 数据权限控制

---

### 字段2：商品图片

**基本信息**

```
字段类型: 附件
字段名称: 商品图片
字段ID: productImage
是否必填: ✅ 是
默认值: 无
```

**配置选项**

```
附件类型: 仅图片
数量限制: 单张（推荐）
文件格式: JPG, PNG, WEBP
建议分辨率: 1024x1024 或更高
文件大小: 不超过10MB
```

**配置截图步骤**

1. 点击"添加字段"
2. 选择"附件"类型
3. 字段名称输入：商品图片
4. 在"附件限制"中选择"仅图片"
5. 保存字段

**用途**

- 作为AI生成的输入素材
- 产品主体图片
- 必须上传才能生成

**数据格式（N8N中使用）**

```json
["img_v2_abc123"]
```

---

### 字段3：场景图

**基本信息**

```
字段类型: 附件
字段名称: 场景图
字段ID: sceneImage
是否必填: 否
默认值: 无
```

**配置选项**

```
附件类型: 仅图片
数量限制: 单张
文件格式: JPG, PNG, WEBP
文件大小: 不超过10MB
```

**配置说明**

- 可选字段，用于提供参考场景
- 如果提供，AI会参考这个场景来生成
- 如果不提供，AI会根据提示词自动创建场景

**用途**

- 提供场景参考
- 控制生成风格
- 提高生成准确性

**数据格式（N8N中使用）**

```json
["img_v2_xyz789"] // 可选，可能为空
```

---

### 字段4：提示词

**基本信息**

```
字段类型: 多行文本
字段名称: 提示词
字段ID: prompt
是否必填: ✅ 是
默认值: 无
```

**配置选项**

```
文本类型: 多行文本
默认行数: 3-5行
最大长度: 2000字符
```

**配置说明**

- 描述想要的场景效果
- 提示词越详细，生成效果越好
- 可以包含风格、环境、光线等描述

**示例内容**

```
你是一位资深电商视觉设计专家，请为这件商品创建一个时尚的展示场景，
背景是现代化的购物环境，光线柔和，突出商品质感。
```

**最佳实践**

- 描述场景风格
- 说明光线要求
- 提及背景元素
- 明确产品展示方式

---

### 字段5：AI模型

**基本信息**

```
字段类型: 单选
字段名称: AI模型
字段ID: aiModel
是否必填: 是
默认值: FLUX.1
```

**选项配置**

| 选项名称       | 选项值           | 说明             |
| -------------- | ---------------- | ---------------- |
| FLUX.1         | `flux-1`         | 默认推荐，质量高 |
| Gemini-3-Pro   | `gemini-3-pro`   | 高级模型         |
| Gemini-2-Flash | `gemini-2-flash` | 快速生成         |

**配置步骤**

1. 字段类型选择"单选"
2. 添加上述3个选项
3. 设置默认值为"FLUX.1"
4. 保存字段

**注意**: 如果飞书表格不需要用户选择，可以在N8N中设置固定默认值

---

### 字段6：尺寸比例

**基本信息**

```
字段类型: 单选
字段名称: 尺寸比例
字段ID: aspectRatio
是否必填: 是
默认值: 3:4
```

**选项配置**

| 选项名称 | 选项值 | 实际尺寸  | 说明         |
| -------- | ------ | --------- | ------------ |
| 1:1      | `1:1`  | 1024x1024 | 正方形       |
| 3:4      | `3:4`  | 768x1024  | 竖版（默认） |
| 16:9     | `16:9` | 1344x768  | 横版宽屏     |
| 9:16     | `9:16` | 768x1344  | 竖版手机     |

**配置步骤**

1. 字段类型选择"单选"
2. 添加上述4个选项
3. 设置默认值为"3:4"
4. 保存字段

**推荐设置**

- 电商商品推荐：3:4 或 9:16
- 社交媒体推荐：1:1 或 9:16
- 横幅广告推荐：16:9

---

### 字段7：生成张数

**基本信息**

```
字段类型: 数字
字段名称: 生成张数
字段ID: imageCount
是否必填: 是
默认值: 4
```

**配置选项**

```
字段类型: 数字
最小值: 1
最大值: 8
默认值: 4
小数位数: 0
```

**配置说明**

- 控制AI生成的图片数量
- 建议4张供用户选择
- 每张图片都会消耗API额度

**配置步骤**

1. 字段类型选择"数字"
2. 设置最小值为1，最大值为8
3. 设置默认值为4
4. 保存字段

---

### 字段8：清晰度

**基本信息**

```
字段类型: 单选
字段名称: 清晰度
字段ID: quality
是否必填: 是
默认值: high
```

**选项配置**

| 选项名称 | 选项值     | 说明             |
| -------- | ---------- | ---------------- |
| 标准     | `standard` | 标准清晰度       |
| 高清     | `high`     | 高清晰度（默认） |
| 超清     | `ultra`    | 超高清           |

**配置说明**

- 控制生成图片的质量
- 高清和超清会消耗更多时间
- 默认推荐"高清"

---

### 字段9：状态

**基本信息**

```
字段类型: 单选
字段名称: 状态
字段ID: status
是否必填: 是
默认值: 待处理
权限: 只读（系统自动更新）
```

**选项配置**

| 选项名称 | 选项值       | 图标 | 说明               |
| -------- | ------------ | ---- | ------------------ |
| 待处理   | `pending`    | ⏳   | 任务创建，等待处理 |
| 上传中   | `uploading`  | 📤   | 正在上传图片       |
| 处理中   | `processing` | ⚙️   | AI正在生成         |
| 生成中   | `generating` | 🎨   | 正在生成图片       |
| 已完成   | `completed`  | ✅   | 生成完成           |
| 生成失败 | `failed`     | ❌   | 生成失败           |

**状态流转**

```
待处理 → 上传中 → 处理中 → 生成中 → 已完成
                    ↓
                 生成失败
```

**配置说明**

- 系统自动更新，用户不可手动修改
- 用于跟踪任务进度
- 前端根据状态显示不同UI

---

### 字段10：进度

**基本信息**

```
字段类型: 数字
字段名称: 进度
字段ID: progress
是否必填: 否
默认值: 0
权限: 只读（系统自动更新）
```

**配置选项**

```
字段类型: 数字
最小值: 0
最大值: 100
默认值: 0
显示格式: 百分比
```

**配置说明**

- 显示任务完成进度
- 0-100的数字
- 可选显示为百分比格式

**进度示例**

- 0 = 待处理
- 25 = 上传中
- 50 = 处理中
- 75 = 生成中
- 100 = 已完成

---

### 字段11：生成结果

**基本信息**

```
字段类型: 附件
字段名称: 生成结果
字段ID: resultImages
是否必填: 否
默认值: 无
权限: 只读（系统自动写入）
```

**配置选项**

```
附件类型: 仅图片
数量限制: 多张（1-8张）
文件格式: JPG, PNG
```

**配置说明**

- 存储AI生成的最终图片
- 系统自动上传和写入
- 用户可查看和下载

**数据格式（N8N中使用）**

```json
["img_result_1", "img_result_2", "img_result_3", "img_result_4"]
```

---

### 字段12：数据来源

**基本信息**

```
字段类型: 单选
字段名称: 数据来源
字段ID: dataSource
是否必填: 是
默认值: 🌐 前端用户
权限: 只读（系统自动填充）
```

**选项配置**

| 选项名称 | 选项值     | 图标 | 说明           |
| -------- | ---------- | ---- | -------------- |
| 前端用户 | `frontend` | 🌐   | 从Web前端创建  |
| 飞书用户 | `feishu`   | 📊   | 从飞书表格创建 |
| API自动  | `api`      | 🤖   | 通过API创建    |

**配置步骤**

1. 字段类型选择"单选"
2. 添加3个选项，使用对应的图标
3. 设置默认值为"🌐 前端用户"
4. 权限设置为"只读"
5. 保存字段

**用途**

- 标识数据来源
- 统计不同渠道的使用量
- 用于数据分析

---

### 字段13：同步状态

**基本信息**

```
字段类型: 单选
字段名称: 同步状态
字段ID: syncStatus
是否必填: 是
默认值: ✅ 已同步
权限: 只读（系统自动更新）
```

**选项配置**

| 选项名称 | 选项值     | 图标 | 说明             |
| -------- | ---------- | ---- | ---------------- |
| 已同步   | `synced`   | ✅   | 数据已同步到飞书 |
| 同步中   | `syncing`  | 🔄   | 正在同步         |
| 冲突     | `conflict` | ⚠️   | 检测到数据冲突   |
| 失败     | `failed`   | ❌   | 同步失败         |

**配置说明**

- 用于跟踪前端和飞书数据同步状态
- 系统自动更新
- 检测并发冲突

**状态流转**

```
前端创建 → 同步中 → 已同步
              ↓
             失败
```

---

## 3. 字段配置截图说明

### 3.1 添加新字段

**步骤截图说明**

1. **打开字段管理**

   ```
   点击表格右上角 "+" 按钮
   或 点击字段标题右侧的 "添加字段" 链接
   ```

2. **选择字段类型**

   ```
   从下拉列表中选择：
   - 文本（用户ID、提示词）
   - 附件（商品图片、场景图、生成结果）
   - 单选（AI模型、尺寸比例、状态、数据来源、同步状态、清晰度）
   - 数字（生成张数、进度）
   - 按钮（点击按钮）
   ```

3. **配置字段属性**
   ```
   字段名称: 输入字段中文名称
   字段ID: 系统自动生成，可手动修改
   默认值: 根据字段类型设置
   选项: 单选字段需要添加选项
   ```

### 3.2 单选字段配置截图

**AI模型字段配置**

```
┌─────────────────────────────────────┐
│  编辑字段                            │
├─────────────────────────────────────┤
│  字段名称: AI模型                    │
│  字段类型: 单选                      │
│  字段ID: aiModel                     │
│                                      │
│  选项管理:                           │
│  ┌────────────────────────────────┐ │
│  │ □ FLUX.1       [默认选项] ✓     │ │
│  │ □ Gemini-3-Pro                 │ │
│  │ □ Gemini-2-Flash               │ │
│  │                                │ │
│  │  [+ 添加选项]                   │ │
│  └────────────────────────────────┘ │
│                                      │
│  允许自定义选项: [ ]                 │
│  彩色标签:     [✓]                   │
│                                      │
│        [取消]  [保存]                │
└─────────────────────────────────────┘
```

### 3.3 附件字段配置截图

**商品图片字段配置**

```
┌─────────────────────────────────────┐
│  编辑字段                            │
├─────────────────────────────────────┤
│  字段名称: 商品图片                  │
│  字段类型: 附件                      │
│  字段ID: productImage               │
│                                      │
│  附件限制:                           │
│  ┌────────────────────────────────┐ │
│  │ ○ 全部类型                     │ │
│  │ ● 仅图片 (推荐)                 │ │
│  │ ○ 仅文档                       │ │
│  └────────────────────────────────┘ │
│                                      │
│  数量限制:                           │
│  ┌────────────────────────────────┐ │
│  │ ● 单张                         │ │
│  │ ○ 多张 (最多: [8] 张)          │ │
│  └────────────────────────────────┘ │
│                                      │
│        [取消]  [保存]                │
└─────────────────────────────────────┘
```

### 3.4 数字字段配置截图

**生成张数字段配置**

```
┌─────────────────────────────────────┐
│  编辑字段                            │
├─────────────────────────────────────┤
│  字段名称: 生成张数                  │
│  字段类型: 数字                      │
│  字段ID: imageCount                 │
│                                      │
│  默认值: [4]                         │
│                                      │
│  数值范围:                           │
│  最小值: [1]                         │
│  最大值: [8]                         │
│                                      │
│  显示格式:                           │
│  ┌────────────────────────────────┐ │
│  │ ● 1234                        │ │
│  │ ○ 1,234                       │ │
│  │ ○ 1,234.56                    │ │
│  └────────────────────────────────┘ │
│                                      │
│        [取消]  [保存]                │
└─────────────────────────────────────┘
```

### 3.5 字段权限配置截图

```
┌─────────────────────────────────────┐
│  编辑字段权限                        │
├─────────────────────────────────────┤
│  字段: 状态                          │
│                                      │
│  权限设置:                           │
│  ┌────────────────────────────────┐ │
│  │ ● 可编辑                       │ │
│  │ ○ 只读 (推荐)                  │ │
│  │ ○ 隐藏                         │ │
│  └────────────────────────────────┘ │
│                                      │
│  说明: 系统自动更新，用户不可修改    │
│                                      │
│        [取消]  [保存]                │
└─────────────────────────────────────┘
```

---

## 4. AI对话URL配置

### 4.1 添加URL字段

**字段配置**

```
字段名称: AI对话
字段类型: URL（超链接）
字段说明: 点击跳转到AI对话界面进行提示词优化
是否必填: 否
```

**配置步骤**

1. 在飞书多维表格中添加新字段
2. 字段类型选择"URL"
3. 字段名称输入：AI对话
4. 保存字段

### 4.2 配置URL模板

**URL格式**

```
开发环境:
https://localhost:3000/ai-chat/{record_id}?prompt={提示词}

生产环境:
https://your-domain.com/ai-chat/{record_id}?prompt={提示词}
```

**URL参数说明**

| 参数          | 说明                       | 示例               |
| ------------- | -------------------------- | ------------------ |
| `{record_id}` | 飞书记录ID（自动填充）     | `rec123456789`     |
| `{提示词}`    | 当前提示词内容（自动填充） | `红色连衣裙，夏装` |

**完整配置示例**

```javascript
{
  "字段名": "AI对话",
  "字段类型": "URL",
  "字段配置": {
    "URL模板": "https://app.example.com/ai-chat/{record_id}?prompt={提示词}",
    "按钮文字": "💬 AI对话优化",
    "按钮颜色": "blue",
    "打开方式": "新窗口"
  }
}
```

### 4.3 按钮显示配置

**推荐配置**

```
按钮文字: 💬 AI对话优化
按钮颜色: 蓝色（推荐）
按钮样式: 主要按钮
打开方式: 新窗口
```

**配置说明**

1. **按钮文字**: 简洁明了，说明功能
2. **按钮颜色**: 蓝色系表示主要操作
3. **打开方式**: 新窗口避免丢失当前表格状态

### 4.4 用户操作流程

**从飞书表格使用AI对话**

```
1. 在"提示词"字段输入初步提示词
2. 点击"💬 AI对话优化"按钮
3. 跳转到Web AI对话页面
4. 进行多轮对话优化提示词
5. 点击"确认并生图"
6. 自动返回飞书表格，提示词已更新
7. 点击"生成主图"按钮开始生成
```

**配置验证**

- [ ] URL字段已添加
- [ ] URL模板配置正确
- [ ] 点击按钮能正常跳转
- [ ] 参数能正确传递
- [ ] 提示词能正常显示

---

## 5. 自动化配置步骤

### 5.1 添加按钮字段

**字段配置**

```
字段名称: 点击按钮
字段类型: 按钮
按钮文本: 点击按钮
是否必填: 是
```

**配置步骤**

1. 添加新字段，类型选择"按钮"
2. 按钮文本输入：点击按钮
3. 保存字段

### 5.2 创建自动化

**自动化1：按钮触发N8N**

```
自动化名称: AI场景图生成-触发N8N

触发器:
  类型: 按钮被点击
  字段: 点击按钮

操作:
  类型: 发送Webhook请求
  URL: [从N8N复制]
  方法: POST
  Headers:
    Content-Type: application/json
  Body (JSON格式):
    {
      "app_token": 触发记录.app_token,
      "table_id": 触发记录.table_id,
      "record_id": 触发记录.record_id
    }
```

**获取Webhook URL**

1. 在N8N中打开工作流
2. 点击"Webhook触发器1"节点
3. 查看"Production URL"
4. 复制URL（例如：`https://n8n.xxx.com/webhook/feishu-trigger-v3`）
5. 粘贴到飞书自动化中

### 5.3 自动化配置截图

**创建自动化**

```
┌─────────────────────────────────────┐
│  飞书多维表格 - 自动化               │
├─────────────────────────────────────┤
│  [+ 新建自动化]                      │
│                                      │
│  自动化列表:                         │
│  ┌────────────────────────────────┐ │
│  │ 🤖 AI场景图生成-触发N8N  [启用]│ │
│  │    触发器: 按钮被点击           │ │
│  │    操作: 发送Webhook请求        │ │
│  └────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**配置触发器**

```
┌─────────────────────────────────────┐
│  配置触发器                          │
├─────────────────────────────────────┤
│  触发条件:                           │
│  ┌────────────────────────────────┐ │
│  │ ● 当字段值变化时                │ │
│  │ ○ 当满足条件时                 │ │
│  │ ○ 定时执行                     │ │
│  │ ○ 按钮被点击 (推荐)            │ │
│  └────────────────────────────────┘ │
│                                      │
│  选择字段:                           │
│  [点击按钮 ▼]                        │
│                                      │
│        [上一步]  [下一步]            │
└─────────────────────────────────────┘
```

**配置操作**

```
┌─────────────────────────────────────┐
│  配置操作                            │
├─────────────────────────────────────┤
│  操作类型:                           │
│  ┌────────────────────────────────┐ │
│  │ ● 发送Webhook请求               │ │
│  │ ○ 发送邮件                     │ │
│  │ ○ 发送群消息                   │ │
│  │ ○ 更新记录                     │ │
│  └────────────────────────────────┘ │
│                                      │
│  请求配置:                           │
│  URL: [https://n8n.xxx.com/...     ] │
│  方法: [POST ▼]                      │
│                                      │
│  请求头:                             │
│  Content-Type: application/json      │
│                                      │
│  请求体:                             │
│  {                                   │
│    "app_token": "{{app_token}}",     │
│    "table_id": "{{table_id}}",       │
│    "record_id": "{{record_id}}"      │
│  }                                   │
│                                      │
│        [上一步]  [完成]              │
└─────────────────────────────────────┘
```

### 5.4 启用自动化

**步骤**

1. 配置完成后，点击"完成"
2. 在自动化列表中找到新建的自动化
3. 点击开关启用自动化
4. 测试自动化是否正常工作

**验证自动化**

- [ ] 自动化已创建
- [ ] 触发器配置正确
- [ ] Webhook URL配置正确
- [ ] 自动化已启用
- [ ] 测试按钮点击能触发N8N

---

## 6. 权限与格式设置

### 6.1 字段权限配置

**权限类型说明**

| 权限类型   | 说明                   | 适用字段                           |
| ---------- | ---------------------- | ---------------------------------- |
| **可编辑** | 用户可以修改           | 提示词、商品图片、场景图、AI模型等 |
| **只读**   | 用户只能查看，不可修改 | 状态、进度、数据来源、同步状态     |
| **隐藏**   | 用户不可见             | 系统内部字段                       |

**权限配置表**

| 字段名称 | 飞书用户权限 | 系统API权限 | 说明         |
| -------- | ------------ | ----------- | ------------ |
| 用户ID   | 只读         | 可编辑      | 系统自动填充 |
| 商品图片 | 可编辑       | 可编辑      | 用户上传     |
| 场景图   | 可编辑       | 可编辑      | 用户可选上传 |
| 提示词   | 可编辑       | 可编辑      | 用户输入     |
| AI模型   | 可编辑       | 可编辑      | 用户选择     |
| 尺寸比例 | 可编辑       | 可编辑      | 用户选择     |
| 生成张数 | 可编辑       | 可编辑      | 用户选择     |
| 清晰度   | 可编辑       | 可编辑      | 用户选择     |
| 状态     | 只读         | 可编辑      | 系统自动更新 |
| 进度     | 只读         | 可编辑      | 系统自动更新 |
| 生成结果 | 只读         | 可编辑      | 系统自动写入 |
| 数据来源 | 只读         | 可编辑      | 系统自动填充 |
| 同步状态 | 只读         | 可编辑      | 系统自动更新 |

### 6.2 条件格式配置

**高亮"同步中"的记录**

```
条件:
  同步状态 = "🔄 同步中"

格式:
  背景颜色: #DBEAFE（浅蓝色）
  边框颜色: #3B82F6
  边框宽度: 2px
```

**高亮"冲突"的记录**

```
条件:
  同步状态 = "⚠️ 冲突"

格式:
  背景颜色: #FEE2E2（浅红色）
  边框颜色: #EF4444
  边框宽度: 2px
  文字颜色: #DC2626
```

**高亮"同步失败"的记录**

```
条件:
  同步状态 = "❌ 失败"

格式:
  背景颜色: #FEE2E2（浅红色）
  文字颜色: #DC2626
```

**高亮"已完成"的记录**

```
条件:
  状态 = "✅ 已完成"

格式:
  背景颜色: #D1FAE5（浅绿色）
  文字颜色: #065F46
```

**配置步骤**

1. 进入"格式"设置
2. 点击"添加条件格式"
3. 设置条件和格式
4. 保存格式规则

### 6.3 字段验证规则

**必填字段验证**

```
字段: 商品图片
验证规则:
  - 不能为空
  - 必须是图片类型
  - 文件大小不超过10MB

错误提示:
  "请上传商品图片（仅支持JPG、PNG、WEBP格式，最大10MB）"
```

```
字段: 提示词
验证规则:
  - 不能为空
  - 最少10个字符
  - 最多2000个字符

错误提示:
  "提示词不能为空，请输入10-2000个字符的描述"
```

**数字范围验证**

```
字段: 生成张数
验证规则:
  - 最小值: 1
  - 最大值: 8
  - 必须是整数

错误提示:
  "生成张数必须是1-8之间的整数"
```

---

## 7. 验证清单

### 7.1 字段配置验证

**基础字段**

- [ ] 用户ID（文本，只读）
- [ ] 商品图片（附件，必填）
- [ ] 场景图（附件，可选）
- [ ] 提示词（多行文本，必填）
- [ ] AI模型（单选，必填）
- [ ] 尺寸比例（单选，必填）
- [ ] 生成张数（数字，必填）
- [ ] 清晰度（单选，必填）
- [ ] 状态（单选，只读）
- [ ] 进度（数字，只读）
- [ ] 生成结果（附件，只读）
- [ ] 数据来源（单选，只读）
- [ ] 同步状态（单选，只读）

**AI对话功能**

- [ ] AI对话（URL字段）
- [ ] URL模板配置正确
- [ ] 点击按钮（按钮字段）

### 7.2 功能验证

**数据输入验证**

- [ ] 能上传商品图片
- [ ] 能上传场景图
- [ ] 能输入提示词
- [ ] 能选择AI模型
- [ ] 能选择尺寸比例
- [ ] 能设置生成张数
- [ ] 能选择清晰度

**自动化验证**

- [ ] 点击按钮能触发自动化
- [ ] 自动化能调用N8N Webhook
- [ ] N8N能接收飞书数据
- [ ] 生成结果能写回飞书
- [ ] 状态能自动更新

**AI对话验证**

- [ ] AI对话按钮能点击
- [ ] 能正确跳转到对话页面
- [ ] 参数能正确传递
- [ ] 优化后提示词能更新

### 7.3 权限验证

- [ ] 只读字段用户无法修改
- [ ] 可编辑字段用户可以修改
- [ ] 系统API能更新所有字段
- [ ] 条件格式正常显示

---

## 8. 常见问题

### 8.1 字段配置问题

**问题1: 字段类型选择错误**

**症状**: 无法配置选项或附件

**解决方法**:

1. 删除错误字段
2. 重新创建，选择正确的字段类型
3. 单选字段要选择"单选"类型
4. 图片字段要选择"附件"类型

**问题2: 选项配置不生效**

**症状**: 单选字段没有选项可选

**解决方法**:

1. 检查是否添加了选项
2. 确认选项名称不为空
3. 检查是否设置了默认选项
4. 保存后刷新页面

**问题3: 附件无法上传**

**症状**: 上传图片失败或无响应

**解决方法**:

1. 检查文件格式是否正确（JPG、PNG、WEBP）
2. 检查文件大小是否超限（通常10MB）
3. 检查网络连接
4. 尝试刷新页面重新上传

### 8.2 自动化问题

**问题1: 自动化未触发**

**症状**: 点击按钮后无反应

**解决方法**:

1. 检查自动化是否已启用
2. 确认Webhook URL配置正确
3. 检查网络连接
4. 查看自动化执行日志

**问题2: N8N未接收到请求**

**症状**: 飞书自动化显示成功，但N8N没有记录

**解决方法**:

1. 检查Webhook URL是否正确
2. 确认使用Production URL而非Test URL
3. 检查N8N Webhook节点是否激活
4. 查看N8N执行日志

**问题3: 生成结果未写回**

**症状**: N8N处理完成，但飞书表格没有更新

**解决方法**:

1. 检查飞书应用权限
2. 确认字段名称完全匹配
3. 检查file_token格式是否正确
4. 查看N8N错误日志

### 8.3 AI对话问题

**问题1: 点击按钮无反应**

**症状**: 点击AI对话按钮没有跳转

**解决方法**:

1. 检查URL字段配置
2. 确认URL模板格式正确
3. 检查域名是否可访问
4. 尝试在新窗口打开

**问题2: 参数未传递**

**症状**: 跳转后页面没有提示词内容

**解决方法**:

1. 检查URL参数配置
2. 确认字段名称正确（{提示词}）
3. 检查特殊字符编码
4. 查看浏览器控制台错误

### 8.4 权限问题

**问题1: 无法修改只读字段**

**症状**: 系统API也无法更新字段

**解决方法**:

1. 检查字段权限配置
2. 确认系统API有写入权限
3. 重新配置字段权限
4. 刷新页面重试

**问题2: 条件格式不显示**

**症状**: 满足条件但没有高亮显示

**解决方法**:

1. 检查条件格式配置
2. 确认条件表达式正确
3. 检查格式设置
4. 重新应用格式规则

---

## 附录

### A. 完整字段清单速查表

| #   | 字段名称 | 字段ID       | 类型     | 必填 | 默认值      | 权限   |
| --- | -------- | ------------ | -------- | ---- | ----------- | ------ |
| 1   | 用户ID   | userId       | 文本     | 否   | 无          | 只读   |
| 2   | 商品图片 | productImage | 附件     | ✅   | 无          | 可编辑 |
| 3   | 场景图   | sceneImage   | 附件     | 否   | 无          | 可编辑 |
| 4   | 提示词   | prompt       | 多行文本 | ✅   | 无          | 可编辑 |
| 5   | AI模型   | aiModel      | 单选     | 是   | FLUX.1      | 可编辑 |
| 6   | 尺寸比例 | aspectRatio  | 单选     | 是   | 3:4         | 可编辑 |
| 7   | 生成张数 | imageCount   | 数字     | 是   | 4           | 可编辑 |
| 8   | 清晰度   | quality      | 单选     | 是   | high        | 可编辑 |
| 9   | 状态     | status       | 单选     | 是   | 待处理      | 只读   |
| 10  | 进度     | progress     | 数字     | 否   | 0           | 只读   |
| 11  | 生成结果 | resultImages | 附件     | 否   | 无          | 只读   |
| 12  | 数据来源 | dataSource   | 单选     | 是   | 🌐 前端用户 | 只读   |
| 13  | 同步状态 | syncStatus   | 单选     | 是   | ✅ 已同步   | 只读   |

### B. 字段映射关系

**前端 ↔ 飞书字段映射**

| 前端字段          | 飞书字段 | 类型     |
| ----------------- | -------- | -------- |
| userId            | 用户ID   | 文本     |
| productImageToken | 商品图片 | 附件     |
| sceneImageToken   | 场景图   | 附件     |
| prompt            | 提示词   | 多行文本 |
| aiModel           | AI模型   | 单选     |
| aspectRatio       | 尺寸比例 | 单选     |
| imageCount        | 生成张数 | 数字     |
| quality           | 清晰度   | 单选     |
| status            | 状态     | 单选     |
| progress          | 进度     | 数字     |
| resultImageTokens | 生成结果 | 附件     |
| dataSource        | 数据来源 | 单选     |
| syncStatus        | 同步状态 | 单选     |

**枚举值映射**

**PromptSource（数据来源）**

| 前端值       | 飞书显示    |
| ------------ | ----------- |
| USER         | 🌐 前端用户 |
| AI_OPTIMIZED | 🌐 前端用户 |
| FEISHU       | 📊 飞书用户 |
| API          | 🤖 API自动  |

**TaskStatus（状态）**

| 前端值     | 飞书显示    |
| ---------- | ----------- |
| PENDING    | ⏳ 待处理   |
| UPLOADING  | 📤 上传中   |
| PROCESSING | ⚙️ 处理中   |
| GENERATING | 🎨 生成中   |
| COMPLETED  | ✅ 已完成   |
| FAILED     | ❌ 生成失败 |

**TaskSyncStatus（同步状态）**

| 前端值   | 飞书显示  |
| -------- | --------- |
| PENDING  | 🔄 同步中 |
| SYNCING  | 🔄 同步中 |
| SYNCED   | ✅ 已同步 |
| FAILED   | ❌ 失败   |
| CONFLICT | ⚠️ 冲突   |

### C. N8N环境变量配置

```bash
# 飞书配置
FEISHU_APP_TOKEN=app_你的AppToken
FEISHU_TABLE_ID=tbl_你的TableID

# N8N回调配置
N8N_API_KEY=n8n-callback-secret-key-2024
```

### D. 相关文档

- [N8N工作流配置指南](./完整配置指南-小白版.md)
- [飞书表格字段配置说明](./飞书表格字段配置说明.md)
- [飞书表格AI对话URL配置指南](./飞书表格AI对话URL配置指南.md)
- [三端字段映射表](./三端字段映射表.md)
- [API接口文档](./API接口文档.md)

---

## 联系支持

如遇到配置问题，请：

1. 查阅本文档的"常见问题"部分
2. 查看相关文档链接
3. 检查系统日志
4. 联系技术支持

---

**文档版本历史**

| 版本 | 日期       | 说明                             |
| ---- | ---------- | -------------------------------- |
| v2.0 | 2026-01-29 | 完整版配置教程，包含13个字段详解 |
| v1.0 | 2026-01-28 | 初始版本                         |

---

**© 2026 AI服装平台 - 飞书多维表格配置教程**
