# 飞书多维表格字段配置说明

## 📋 完整字段列表及要求

根据你的实际表格结构，以下是所有字段的详细配置：

### 1. 序号 (可选)

| 属性     | 值                     |
| -------- | ---------------------- |
| 字段类型 | 数字 或 文本           |
| 是否必填 | 否                     |
| 说明     | 用于标记任务序号，可选 |
| 示例值   | `1`, `2`, `3`          |

---

### 2. 提示词 (必需)

| 属性     | 值                                                                                                                   |
| -------- | -------------------------------------------------------------------------------------------------------------------- |
| 字段类型 | 多行文本                                                                                                             |
| 是否必填 | ✅ 是                                                                                                                |
| 字段说明 | AI生成的提示词，描述想要的场景效果                                                                                   |
| 示例值   | `"你是一位资深电商视觉设计专家，请为这件商品创建一个时尚的展示场景，背景是现代化的购物环境，光线柔和，突出商品质感"` |
| 注意事项 | - 提示词越详细，生成效果越好<br>- 可以包含风格、环境、光线等描述                                                     |

---

### 3. 商品图片 (必需)

| 属性       | 值                       |
| ---------- | ------------------------ |
| 字段类型   | 附件                     |
| 是否必填   | ✅ 是                    |
| 附件类型   | 仅图片                   |
| 数量限制   | 单张（或限制1-3张）      |
| 说明       | 需要生成场景图的产品图片 |
| 文件格式   | JPG, PNG, WEBP           |
| 建议分辨率 | 1024x1024 或更高         |
| 用途       | 作为AI生成的输入素材     |

**N8N中使用**：

- 字段名：`商品图片`
- 数据格式：`["img_token_abc123"]`（file_token数组）
- 会被下载并传递给AI服务

---

### 4. 场景图 (可选)

| 属性     | 值                                       |
| -------- | ---------------------------------------- |
| 字段类型 | 附件                                     |
| 是否必填 | 否                                       |
| 附件类型 | 仅图片                                   |
| 数量限制 | 单张                                     |
| 说明     | 可选的参考场景图片                       |
| 文件格式 | JPG, PNG, WEBP                           |
| 用途     | 如果提供了场景图，AI会参考这个场景来生成 |

**N8N中使用**：

- 字段名：`场景图`
- 数据格式：`["img_token_xyz789"]`（file_token数组）
- 如果提供，会下载并作为sceneImageUrl传递给AI
- 如果不提供，sceneImageUrl为空

---

### 5. 生成主图 (按钮)

| 属性     | 值                            |
| -------- | ----------------------------- |
| 字段类型 | 按钮                          |
| 按钮文本 | "生成主图" 或 "点击按钮"      |
| 触发动作 | 调用飞书机器人，触发N8N工作流 |
| 说明     | 用户点击后，触发生成流程      |

**配置方式**：

1. 在飞书多维表格中添加"按钮"类型字段
2. 按钮类型选择："触发自动化"
3. 关联飞书机器人或自动化流程

---

### 6. AI生成场景图 (结果字段)

| 属性     | 值                   |
| -------- | -------------------- |
| 字段类型 | 附件                 |
| 是否必填 | 否                   |
| 附件类型 | 仅图片               |
| 数量限制 | 多张（建议4-8张）    |
| 说明     | AI生成的场景图结果   |
| 用途     | 存储AI生成的最终图片 |

**N8N中使用**：

- 字段名：`AI生成场景图`
- 写入格式：上传图片后的file_token数组
- 数据示例：`["img_result_1", "img_result_2", "img_result_3", "img_result_4"]`

---

### 7. 状态 (必需)

| 属性     | 值                                                                                    |
| -------- | ------------------------------------------------------------------------------------- |
| 字段类型 | 单选 或 文本                                                                          |
| 是否必填 | 是                                                                                    |
| 可选值   | `Idle`（空闲）<br>`Processing`（处理中）<br>`Completed`（已完成）<br>`Failed`（失败） |
| 默认值   | `Idle`                                                                                |
| 说明     | 标识当前任务的状态                                                                    |

**N8N中使用**：

- 字段名：`状态`
- 初始值：`Idle`
- 开始处理时更新为：`Processing`
- 完成时更新为：`Completed`
- 失败时更新为：`Failed`

---

### 8. id (系统字段)

| 属性     | 值                                |
| -------- | --------------------------------- |
| 字段类型 | 文本                              |
| 是否必填 | 自动生成                          |
| 说明     | 飞书自动生成的记录ID（record_id） |
| 格式     | `rec` + 22位字符                  |
| 示例值   | `recaHgm6a5`, `recmDEqUWY`        |

**N8N中使用**：

- 作为 `record_id` 使用
- 用于更新和查询特定记录

---

## ⚠️ 重要说明

### 关于AI模型字段

**你的表格中没有AI模型字段，这是正确的！**

理由：

1. ✅ **AI模型应该在后端配置默认值**
2. ✅ **简化用户操作**，用户不需要了解技术细节
3. ✅ **统一质量标准**，使用固定的模型保证输出质量

**配置方式**：

在N8N工作流中设置默认模型：

```javascript
// 在"解析飞书参数"节点中添加
{
  "recordId": "={{ $json.rawData.record_id }}",
  "prompt": "={{ $json.rawData.fields['提示词'] }}",
  "productImageToken": "={{ $json.rawData.fields['商品图片'][0] }}",
  "sceneImageToken": "={{ $json.rawData.fields['场景图'] && $json.rawData.fields['场景图'][0] }}", // 可选
  "aiModel": "flux-realism",  // ⭐ 固定默认值
  "aspectRatio": "1:1",       // ⭐ 固定默认值
  "imageCount": 4             // ⭐ 固定默认值
}
```

**如果前端需要用户选择**：

- 前端UI可以提供选择
- 但飞书表格中不需要这个字段
- 保持两种路径的差异

---

## 📊 字段对比：前端 vs 飞书

| 参数     | 前端（用户选择） | 飞书表格    | 说明         |
| -------- | ---------------- | ----------- | ------------ |
| 提示词   | ✅ 用户输入      | ✅ 用户输入 | 两者都有     |
| 商品图片 | ✅ 上传          | ✅ 上传     | 两者都有     |
| 场景图   | ✅ 可选上传      | ✅ 可选上传 | 两者都有     |
| AI模型   | ✅ 用户选择      | ❌ 使用默认 | 飞书用固定值 |
| 图片比例 | ✅ 用户选择      | ❌ 使用默认 | 飞书用固定值 |
| 生成数量 | ✅ 用户选择      | ❌ 使用默认 | 飞书用固定值 |
| 回调地址 | ✅ 自动生成      | ❌ 不需要   | 飞书直接更新 |

**默认值建议**：

```javascript
aiModel: 'flux-realism'; // 推荐模型
aspectRatio: '1:1'; // 正方形，适合电商
imageCount: 4; // 生成4张供选择
```

---

## 🔧 N8N工作流更新

需要在飞书路径中处理**场景图**字段：

### 节点5：解析飞书参数（更新版）

```javascript
{
  "recordId": "={{ $json.rawData.record_id }}",
  "prompt": "={{ $json.rawData.fields['提示词'] }}",
  "productImageToken": "={{ $json.rawData.fields['商品图片'][0] }}",
  "sceneImageToken": "={{ $json.rawData.fields['场景图'] && $json.rawData.fields['场景图'][0] }}",  // ⭐ 新增
  "aiModel": "flux-realism",     // ⭐ 固定默认值
  "aspectRatio": "1:1",          // ⭐ 固定默认值
  "imageCount": 4                // ⭐ 固定默认值
}
```

### 新增节点：下载场景图（可选）

如果用户提供了场景图，需要下载：

**节点：下载场景图**

```javascript
// 类型：HTTP Request
// Method: GET
// URL: https://open.feishu.cn/open-apis/drive/v1/medias/{{ sceneImageToken }}/download
// 条件执行：仅当 sceneImageToken 存在时
```

### 更新节点：设置飞书图片URL

需要同时处理商品图和场景图：

```javascript
{
  "productImageUrl": "={{ $binary.data.url }}",  // 商品图URL
  "sceneImageUrl": "={{ $json.sceneImageUrl }}"  // 场景图URL（如果有）
}
```

---

## ✅ 配置清单

### 飞书多维表格配置

- [ ] 字段1：序号（数字，可选）
- [ ] 字段2：提示词（多行文本，必填）
- [ ] 字段3：商品图片（附件，必填）
- [ ] 字段4：场景图（附件，可选）
- [ ] 字段5：生成主图（按钮，触发器）
- [ ] 字段6：AI生成场景图（附件，结果）
- [ ] 字段7：状态（单选，必填）
- [ ] 字段8：id（自动生成）

### N8N工作流配置

- [ ] 更新"解析飞书参数"节点，添加场景图处理
- [ ] 添加场景图下载节点（可选）
- [ ] 设置AI模型默认值
- [ ] 设置图片比例默认值
- [ ] 设置生成数量默认值
- [ ] 更新"格式化飞书结果"节点，写入"AI生成场景图"字段

---

## 🎯 总结

### 需要在飞书表格中填写的字段（用户操作）

1. ✅ **提示词** - 必填，描述想要的场景
2. ✅ **商品图片** - 必填，上传产品图
3. ✅ **场景图** - 可选，上传参考场景
4. ✅ **点击"生成主图"按钮** - 触发AI生成

### 自动处理的字段（系统操作）

1. ⚙️ **AI模型** - 自动使用默认值（flux-realism）
2. ⚙️ **图片比例** - 自动使用默认值（1:1）
3. ⚙️ **生成数量** - 自动使用默认值（4张）
4. ⚙️ **状态** - 自动更新（Idle → Processing → Completed）
5. ⚙️ **AI生成场景图** - 自动写入生成结果

这样用户操作最简单，只需要填写提示词和上传图片即可！🎉
